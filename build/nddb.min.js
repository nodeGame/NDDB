/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2015 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/master/LICENSE
 */// vim: ts=4 sts=4 sw=4 expandtab
// Add semicolon to prevent IIFE from being passed as argument to concatenated code.

(function(e,t){"use strict";typeof define=="function"&&define.amd?define(t):typeof exports=="object"?module.exports=t():e.returnExports=t()})(this,function(){var e=Array,t=e.prototype,n=Object,r=n.prototype,i=Function,s=i.prototype,o=String,u=o.prototype,a=Number,f=a.prototype,l=t.slice,c=t.splice,h=t.push,p=t.unshift,d=t.concat,v=t.join,m=s.call,g=s.apply,y=Math.max,b=Math.min,w=r.toString,E=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",S,x=Function.prototype.toString,T=/^\s*class /,N=function(t){try{var n=x.call(t),r=n.replace(/\/\/.*\n/g,""),i=r.replace(/\/\*[.\s\S]*\*\//g,""),s=i.replace(/\n/mg," ").replace(/ {2}/g," ");return T.test(s)}catch(o){return!1}},C=function(t){try{return N(t)?!1:(x.call(t),!0)}catch(n){return!1}},k="[object Function]",L="[object GeneratorFunction]",S=function(t){if(!t)return!1;if(typeof t!="function"&&typeof t!="object")return!1;if(E)return C(t);if(N(t))return!1;var n=w.call(t);return n===k||n===L},A,O=RegExp.prototype.exec,M=function(t){try{return O.call(t),!0}catch(n){return!1}},_="[object RegExp]";A=function(t){return typeof t!="object"?!1:E?M(t):w.call(t)===_};var D,P=String.prototype.valueOf,H=function(t){try{return P.call(t),!0}catch(n){return!1}},B="[object String]";D=function(t){return typeof t=="string"?!0:typeof t!="object"?!1:E?H(t):w.call(t)===B};var j=n.defineProperty&&function(){try{var e={};n.defineProperty(e,"x",{enumerable:!1,value:e});for(var t in e)return!1;return e.x===e}catch(r){return!1}}(),F=function(e){var t;return j?t=function(e,t,r,i){if(!i&&t in e)return;n.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r})}:t=function(e,t,n,r){if(!r&&t in e)return;e[t]=n},function(r,i,s){for(var o in i)e.call(i,o)&&t(r,o,i[o],s)}}(r.hasOwnProperty),I=function(t){var n=typeof t;return t===null||n!=="object"&&n!=="function"},q=a.isNaN||function(t){return t!==t},R={ToInteger:function(t){var n=+t;return q(n)?n=0:n!==0&&n!==1/0&&n!==-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n))),n},ToPrimitive:function(t){var n,r,i;if(I(t))return t;r=t.valueOf;if(S(r)){n=r.call(t);if(I(n))return n}i=t.toString;if(S(i)){n=i.call(t);if(I(n))return n}throw new TypeError},ToObject:function(e){if(e==null)throw new TypeError("can't convert "+e+" to object");return n(e)},ToUint32:function(t){return t>>>0}},U=function(){};F(s,{bind:function(t){var r=this;if(!S(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);var s=l.call(arguments,1),o,u=function(){if(this instanceof o){var e=g.call(r,this,d.call(s,l.call(arguments)));return n(e)===e?e:this}return g.call(r,t,d.call(s,l.call(arguments)))},a=y(0,r.length-s.length),f=[];for(var c=0;c<a;c++)h.call(f,"$"+c);return o=i("binder","return function ("+v.call(f,",")+"){ return binder.apply(this, arguments); }")(u),r.prototype&&(U.prototype=r.prototype,o.prototype=new U,U.prototype=null),o}});var z=m.bind(r.hasOwnProperty),W=m.bind(r.toString),X=m.bind(l),V=g.bind(l),$=m.bind(u.slice),J=m.bind(u.split),K=m.bind(u.indexOf),Q=m.bind(h),G=m.bind(r.propertyIsEnumerable),Y=m.bind(t.sort),Z=e.isArray||function(t){return W(t)==="[object Array]"},et=[].unshift(0)!==1;F(t,{unshift:function(){return p.apply(this,arguments),this.length}},et),F(e,{isArray:Z});var tt=n("a"),nt=tt[0]!=="a"||!(0 in tt),rt=function(t){var n=!0,r=!0,i=!1;if(t)try{t.call("foo",function(e,t,r){typeof r!="object"&&(n=!1)}),t.call([1],function(){"use strict";r=typeof this=="string"},"x")}catch(s){i=!0}return!!t&&!i&&n&&r};F(t,{forEach:function(t){var n=R.ToObject(this),r=nt&&D(this)?J(this,""):n,i=-1,s=R.ToUint32(r.length),o;arguments.length>1&&(o=arguments[1]);if(!S(t))throw new TypeError("Array.prototype.forEach callback must be a function");while(++i<s)i in r&&(typeof o=="undefined"?t(r[i],i,n):t.call(o,r[i],i,n))}},!rt(t.forEach)),F(t,{map:function(n){var r=R.ToObject(this),i=nt&&D(this)?J(this,""):r,s=R.ToUint32(i.length),o=e(s),u;arguments.length>1&&(u=arguments[1]);if(!S(n))throw new TypeError("Array.prototype.map callback must be a function");for(var a=0;a<s;a++)a in i&&(typeof u=="undefined"?o[a]=n(i[a],a,r):o[a]=n.call(u,i[a],a,r));return o}},!rt(t.map)),F(t,{filter:function(t){var n=R.ToObject(this),r=nt&&D(this)?J(this,""):n,i=R.ToUint32(r.length),s=[],o,u;arguments.length>1&&(u=arguments[1]);if(!S(t))throw new TypeError("Array.prototype.filter callback must be a function");for(var a=0;a<i;a++)a in r&&(o=r[a],(typeof u=="undefined"?t(o,a,n):t.call(u,o,a,n))&&Q(s,o));return s}},!rt(t.filter)),F(t,{every:function(t){var n=R.ToObject(this),r=nt&&D(this)?J(this,""):n,i=R.ToUint32(r.length),s;arguments.length>1&&(s=arguments[1]);if(!S(t))throw new TypeError("Array.prototype.every callback must be a function");for(var o=0;o<i;o++)if(o in r&&(typeof s=="undefined"?!t(r[o],o,n):!t.call(s,r[o],o,n)))return!1;return!0}},!rt(t.every)),F(t,{some:function(t){var n=R.ToObject(this),r=nt&&D(this)?J(this,""):n,i=R.ToUint32(r.length),s;arguments.length>1&&(s=arguments[1]);if(!S(t))throw new TypeError("Array.prototype.some callback must be a function");for(var o=0;o<i;o++)if(o in r&&(typeof s=="undefined"?t(r[o],o,n):t.call(s,r[o],o,n)))return!0;return!1}},!rt(t.some));var it=!1;t.reduce&&(it=typeof t.reduce.call("es5",function(e,t,n,r){return r})=="object"),F(t,{reduce:function(t){var n=R.ToObject(this),r=nt&&D(this)?J(this,""):n,i=R.ToUint32(r.length);if(!S(t))throw new TypeError("Array.prototype.reduce callback must be a function");if(i===0&&arguments.length===1)throw new TypeError("reduce of empty array with no initial value");var s=0,o;if(arguments.length>=2)o=arguments[1];else do{if(s in r){o=r[s++];break}if(++s>=i)throw new TypeError("reduce of empty array with no initial value")}while(!0);for(;s<i;s++)s in r&&(o=t(o,r[s],s,n));return o}},!it);var st=!1;t.reduceRight&&(st=typeof t.reduceRight.call("es5",function(e,t,n,r){return r})=="object"),F(t,{reduceRight:function(t){var n=R.ToObject(this),r=nt&&D(this)?J(this,""):n,i=R.ToUint32(r.length);if(!S(t))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(i===0&&arguments.length===1)throw new TypeError("reduceRight of empty array with no initial value");var s,o=i-1;if(arguments.length>=2)s=arguments[1];else do{if(o in r){s=r[o--];break}if(--o<0)throw new TypeError("reduceRight of empty array with no initial value")}while(!0);if(o<0)return s;do o in r&&(s=t(s,r[o],o,n));while(o--);return s}},!st);var ot=t.indexOf&&[0,1].indexOf(1,2)!==-1;F(t,{indexOf:function(t){var n=nt&&D(this)?J(this,""):R.ToObject(this),r=R.ToUint32(n.length);if(r===0)return-1;var i=0;arguments.length>1&&(i=R.ToInteger(arguments[1])),i=i>=0?i:y(0,r+i);for(;i<r;i++)if(i in n&&n[i]===t)return i;return-1}},ot);var ut=t.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;F(t,{lastIndexOf:function(t){var n=nt&&D(this)?J(this,""):R.ToObject(this),r=R.ToUint32(n.length);if(r===0)return-1;var i=r-1;arguments.length>1&&(i=b(i,R.ToInteger(arguments[1]))),i=i>=0?i:r-Math.abs(i);for(;i>=0;i--)if(i in n&&t===n[i])return i;return-1}},ut);var at=function(){var e=[1,2],t=e.splice();return e.length===2&&Z(t)&&t.length===0}();F(t,{splice:function(t,n){return arguments.length===0?[]:c.apply(this,arguments)}},!at);var ft=function(){var e={};return t.splice.call(e,0,0,1),e.length===1}();F(t,{splice:function(t,n){if(arguments.length===0)return[];var r=arguments;return this.length=y(R.ToInteger(this.length),0),arguments.length>0&&typeof n!="number"&&(r=X(arguments),r.length<2?Q(r,this.length-t):r[1]=R.ToInteger(n)),c.apply(this,r)}},!ft);var lt=function(){var t=new e(1e5);return t[8]="x",t.splice(1,1),t.indexOf("x")===7}(),ct=function(){var e=256,t=[];return t[e]="a",t.splice(e+1,0,"b"),t[e]==="a"}();F(t,{splice:function(t,n){var r=R.ToObject(this),i=[],s=R.ToUint32(r.length),u=R.ToInteger(t),a=u<0?y(s+u,0):b(u,s),f=b(y(R.ToInteger(n),0),s-a),l=0,c;while(l<f)c=o(a+l),z(r,c)&&(i[l]=r[c]),l+=1;var h=X(arguments,2),p=h.length,d;if(p<f){l=a;var v=s-f;while(l<v)c=o(l+f),d=o(l+p),z(r,c)?r[d]=r[c]:delete r[d],l+=1;l=s;var m=s-f+p;while(l>m)delete r[l-1],l-=1}else if(p>f){l=s-f;while(l>a)c=o(l+f-1),d=o(l+p-1),z(r,c)?r[d]=r[c]:delete r[d],l-=1}l=a;for(var g=0;g<h.length;++g)r[l]=h[g],l+=1;return r.length=s-f+p,i}},!lt||!ct);var ht=t.join,pt;try{pt=Array.prototype.join.call("123",",")!=="1,2,3"}catch(dt){pt=!0}pt&&F(t,{join:function(t){var n=typeof t=="undefined"?",":t;return ht.call(D(this)?J(this,""):this,n)}},pt);var vt=[1,2].join(undefined)!=="1,2";vt&&F(t,{join:function(t){var n=typeof t=="undefined"?",":t;return ht.call(this,n)}},vt);var mt=function(t){var n=R.ToObject(this),r=R.ToUint32(n.length),i=0;while(i<arguments.length)n[r+i]=arguments[i],i+=1;return n.length=r+i,r+i},gt=function(){var e={},t=Array.prototype.push.call(e,undefined);return t!==1||e.length!==1||typeof e[0]!="undefined"||!z(e,0)}();F(t,{push:function(t){return Z(this)?h.apply(this,arguments):mt.apply(this,arguments)}},gt);var yt=function(){var e=[],t=e.push(undefined);return t!==1||e.length!==1||typeof e[0]!="undefined"||!z(e,0)}();F(t,{push:mt},yt),F(t,{slice:function(e,t){var n=D(this)?J(this,""):this;return V(n,arguments)}},nt);var bt=function(){try{return[1,2].sort(null),[1,2].sort({}),!0}catch(e){}return!1}(),wt=function(){try{return[1,2].sort(/a/),!1}catch(e){}return!0}(),Et=function(){try{return[1,2].sort(undefined),!0}catch(e){}return!1}();F(t,{sort:function(t){if(typeof t=="undefined")return Y(this);if(!S(t))throw new TypeError("Array.prototype.sort callback must be a function");return Y(this,t)}},bt||!Et||!wt);var St=!G({toString:null},"toString"),xt=G(function(){},"prototype"),Tt=!z("x","0"),Nt=function(e){var t=e.constructor;return t&&t.prototype===e},Ct={$window:!0,$console:!0,$parent:!0,$self:!0,$frame:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$external:!0},kt=function(){if(typeof window=="undefined")return!1;for(var e in window)try{!Ct["$"+e]&&z(window,e)&&window[e]!==null&&typeof window[e]=="object"&&Nt(window[e])}catch(t){return!0}return!1}(),Lt=function(e){if(typeof window=="undefined"||!kt)return Nt(e);try{return Nt(e)}catch(t){return!1}},At=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Ot=At.length,Mt=function(t){return W(t)==="[object Arguments]"},_t=function(t){return t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&!Z(t)&&S(t.callee)},Dt=Mt(arguments)?Mt:_t;F(n,{keys:function(t){var n=S(t),r=Dt(t),i=t!==null&&typeof t=="object",s=i&&D(t);if(!i&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var u=[],a=xt&&n;if(s&&Tt||r)for(var f=0;f<t.length;++f)Q(u,o(f));if(!r)for(var l in t)(!a||l!=="prototype")&&z(t,l)&&Q(u,o(l));if(St){var c=Lt(t);for(var h=0;h<Ot;h++){var p=At[h];(!c||p!=="constructor")&&z(t,p)&&Q(u,p)}}return u}});var Pt=n.keys&&function(){return n.keys(arguments).length===2}(1,2),Ht=n.keys&&function(){var e=n.keys(arguments);return arguments.length!==1||e.length!==1||e[0]!==1}(1),Bt=n.keys;F(n,{keys:function(t){return Dt(t)?Bt(X(t)):Bt(t)}},!Pt||Ht);var jt=(new Date(-0xc782b5b342b24)).getUTCMonth()!==0,Ft=new Date(-0x55d318d56a724),It=new Date(14496624e5),qt=Ft.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT",Rt,Ut,zt=Ft.getTimezoneOffset();zt<-720?(Rt=Ft.toDateString()!=="Tue Jan 02 -45875",Ut=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(It.toString())):(Rt=Ft.toDateString()!=="Mon Jan 01 -45875",Ut=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(It.toString()));var Wt=m.bind(Date.prototype.getFullYear),Xt=m.bind(Date.prototype.getMonth),Vt=m.bind(Date.prototype.getDate),$t=m.bind(Date.prototype.getUTCFullYear),Jt=m.bind(Date.prototype.getUTCMonth),Kt=m.bind(Date.prototype.getUTCDate),Qt=m.bind(Date.prototype.getUTCDay),Gt=m.bind(Date.prototype.getUTCHours),Yt=m.bind(Date.prototype.getUTCMinutes),Zt=m.bind(Date.prototype.getUTCSeconds),en=m.bind(Date.prototype.getUTCMilliseconds),tn=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],nn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],rn=function(t,n){return Vt(new Date(n,t,0))};F(Date.prototype,{getFullYear:function(){if(!!this&&this instanceof Date){var t=Wt(this);return t<0&&Xt(this)>11?t+1:t}throw new TypeError("this is not a Date object.")},getMonth:function(){if(!!this&&this instanceof Date){var t=Wt(this),n=Xt(this);return t<0&&n>11?0:n}throw new TypeError("this is not a Date object.")},getDate:function(){if(!!this&&this instanceof Date){var t=Wt(this),n=Xt(this),r=Vt(this);if(t<0&&n>11){if(n===12)return r;var i=rn(0,t+1);return i-r+1}return r}throw new TypeError("this is not a Date object.")},getUTCFullYear:function(){if(!!this&&this instanceof Date){var t=$t(this);return t<0&&Jt(this)>11?t+1:t}throw new TypeError("this is not a Date object.")},getUTCMonth:function(){if(!!this&&this instanceof Date){var t=$t(this),n=Jt(this);return t<0&&n>11?0:n}throw new TypeError("this is not a Date object.")},getUTCDate:function(){if(!!this&&this instanceof Date){var t=$t(this),n=Jt(this),r=Kt(this);if(t<0&&n>11){if(n===12)return r;var i=rn(0,t+1);return i-r+1}return r}throw new TypeError("this is not a Date object.")}},jt),F(Date.prototype,{toUTCString:function(){if(!!this&&this instanceof Date){var t=Qt(this),n=Kt(this),r=Jt(this),i=$t(this),s=Gt(this),o=Yt(this),u=Zt(this);return tn[t]+", "+(n<10?"0"+n:n)+" "+nn[r]+" "+i+" "+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+":"+(u<10?"0"+u:u)+" GMT"}throw new TypeError("this is not a Date object.")}},jt||qt),F(Date.prototype,{toDateString:function(){if(!!this&&this instanceof Date){var t=this.getDay(),n=this.getDate(),r=this.getMonth(),i=this.getFullYear();return tn[t]+" "+nn[r]+" "+(n<10?"0"+n:n)+" "+i}throw new TypeError("this is not a Date object.")}},jt||Rt);if(jt||Ut)Date.prototype.toString=function jn(){if(!!this&&this instanceof Date){var e=this.getDay(),t=this.getDate(),n=this.getMonth(),r=this.getFullYear(),i=this.getHours(),s=this.getMinutes(),o=this.getSeconds(),u=this.getTimezoneOffset(),a=Math.floor(Math.abs(u)/60),f=Math.floor(Math.abs(u)%60);return tn[e]+" "+nn[n]+" "+(t<10?"0"+t:t)+" "+r+" "+(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+" GMT"+(u>0?"-":"+")+(a<10?"0"+a:a)+(f<10?"0"+f:f)}throw new TypeError("this is not a Date object.")},j&&n.defineProperty(Date.prototype,"toString",{configurable:!0,enumerable:!1,writable:!0});var sn=-621987552e5,on="-000001",un=Date.prototype.toISOString&&(new Date(sn)).toISOString().indexOf(on)===-1,an=Date.prototype.toISOString&&(new Date(-1)).toISOString()!=="1969-12-31T23:59:59.999Z",fn=m.bind(Date.prototype.getTime);F(Date.prototype,{toISOString:function(){if(!isFinite(this)||!isFinite(fn(this)))throw new RangeError("Date.prototype.toISOString called on non-finite value.");var t=$t(this),n=Jt(this);t+=Math.floor(n/12),n=(n%12+12)%12;var r=[n+1,Kt(this),Gt(this),Yt(this),Zt(this)];t=(t<0?"-":t>9999?"+":"")+$("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var i=0;i<r.length;++i)r[i]=$("00"+r[i],-2);return t+"-"+X(r,0,2).join("-")+"T"+X(r,2).join(":")+"."+$("000"+en(this),-3)+"Z"}},un||an);var ln=function(){try{return Date.prototype.toJSON&&(new Date(NaN)).toJSON()===null&&(new Date(sn)).toJSON().indexOf(on)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(e){return!1}}();ln||(Date.prototype.toJSON=function(t){var r=n(this),i=R.ToPrimitive(r);if(typeof i=="number"&&!isFinite(i))return null;var s=r.toISOString;if(!S(s))throw new TypeError("toISOString property is not callable");return s.call(r)});var cn=Date.parse("+033658-09-27T01:46:40.000Z")===1e15,hn=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z")),pn=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(pn||hn||!cn){var dn=Math.pow(2,31)-1,vn=q((new Date(1970,0,1,0,0,0,dn+1)).getTime());Date=function(e){var t=function(r,i,s,u,a,f,l){var c=arguments.length,h;if(this instanceof e){var p=f,d=l;if(vn&&c>=7&&l>dn){var v=Math.floor(l/dn)*dn,m=Math.floor(v/1e3);p+=m,d-=m*1e3}h=c===1&&o(r)===r?new e(t.parse(r)):c>=7?new e(r,i,s,u,a,p,d):c>=6?new e(r,i,s,u,a,p):c>=5?new e(r,i,s,u,a):c>=4?new e(r,i,s,u):c>=3?new e(r,i,s):c>=2?new e(r,i):c>=1?new e(r instanceof e?+r:r):new e}else h=e.apply(this,arguments);return I(h)||F(h,{constructor:t},!0),h},n=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),r=[0,31,59,90,120,151,181,212,243,273,304,334,365],i=function(t,n){var i=n>1?1:0;return r[n]+Math.floor((t-1969+i)/4)-Math.floor((t-1901+i)/100)+Math.floor((t-1601+i)/400)+365*(t-1970)},s=function(n){var r=0,i=n;if(vn&&i>dn){var s=Math.floor(i/dn)*dn,o=Math.floor(s/1e3);r+=o,i-=o*1e3}return a(new e(1970,0,1,0,0,r,i))};for(var u in e)z(e,u)&&(t[u]=e[u]);F(t,{now:e.now,UTC:e.UTC},!0),t.prototype=e.prototype,F(t.prototype,{constructor:t},!0);var f=function(r){var o=n.exec(r);if(o){var u=a(o[1]),f=a(o[2]||1)-1,l=a(o[3]||1)-1,c=a(o[4]||0),h=a(o[5]||0),p=a(o[6]||0),d=Math.floor(a(o[7]||0)*1e3),v=Boolean(o[4]&&!o[8]),m=o[9]==="-"?1:-1,g=a(o[10]||0),y=a(o[11]||0),b,w=h>0||p>0||d>0;if(c<(w?24:25)&&h<60&&p<60&&d<1e3&&f>-1&&f<12&&g<24&&y<60&&l>-1&&l<i(u,f+1)-i(u,f)){b=((i(u,f)+l)*24+c+g*m)*60,b=((b+h+y*m)*60+p)*1e3+d,v&&(b=s(b));if(-864e13<=b&&b<=864e13)return b}return NaN}return e.parse.apply(this,arguments)};return F(t,{parse:f}),t}(Date)}Date.now||(Date.now=function(){return(new Date).getTime()});var mn=f.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||0xde0b6b3a7640080.toFixed(0)!=="1000000000000000128"),gn={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(t,n){var r=-1,i=n;while(++r<gn.size)i+=t*gn.data[r],gn.data[r]=i%gn.base,i=Math.floor(i/gn.base)},divide:function(t){var n=gn.size,r=0;while(--n>=0)r+=gn.data[n],gn.data[n]=Math.floor(r/t),r=r%t*gn.base},numToString:function(){var t=gn.size,n="";while(--t>=0)if(n!==""||t===0||gn.data[t]!==0){var r=o(gn.data[t]);n===""?n=r:n+=$("0000000",0,7-r.length)+r}return n},pow:function Fn(e,t,n){return t===0?n:t%2===1?Fn(e,t-1,n*e):Fn(e*e,t/2,n)},log:function(t){var n=0,r=t;while(r>=4096)n+=12,r/=4096;while(r>=2)n+=1,r/=2;return n}},yn=function(t){var n,r,i,s,u,f,l,c;n=a(t),n=q(n)?0:Math.floor(n);if(n<0||n>20)throw new RangeError("Number.toFixed called with invalid number of decimals");r=a(this);if(q(r))return"NaN";if(r<=-1e21||r>=1e21)return o(r);i="",r<0&&(i="-",r=-r),s="0";if(r>1e-21){u=gn.log(r*gn.pow(2,69,1))-69,f=u<0?r*gn.pow(2,-u,1):r/gn.pow(2,u,1),f*=4503599627370496,u=52-u;if(u>0){gn.multiply(0,f),l=n;while(l>=7)gn.multiply(1e7,0),l-=7;gn.multiply(gn.pow(10,l,1),0),l=u-1;while(l>=23)gn.divide(1<<23),l-=23;gn.divide(1<<l),gn.multiply(1,1),gn.divide(2),s=gn.numToString()}else gn.multiply(0,f),gn.multiply(1<<-u,0),s=gn.numToString()+$("0.00000000000000000000",2,2+n)}return n>0?(c=s.length,c<=n?s=i+$("0.0000000000000000000",0,n-c+2)+s:s=i+$(s,0,c-n)+"."+$(s,c-n)):s=i+s,s};F(f,{toFixed:yn},mn);var bn=function(){try{return 1..toPrecision(undefined)==="1"}catch(e){return!0}}(),wn=f.toPrecision;F(f,{toPrecision:function(t){return typeof t=="undefined"?wn.call(this):wn.call(this,t)}},bn),"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var e=typeof /()??/.exec("")[1]=="undefined",t=Math.pow(2,32)-1;u.split=function(n,r){var i=String(this);if(typeof n=="undefined"&&r===0)return[];if(!A(n))return J(this,n,r);var s=[],o=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),u=0,a,f,l,c,p=new RegExp(n.source,o+"g");e||(a=new RegExp("^"+p.source+"$(?!\\s)",o));var d=typeof r=="undefined"?t:R.ToUint32(r);f=p.exec(i);while(f){l=f.index+f[0].length;if(l>u){Q(s,$(i,u,f.index)),!e&&f.length>1&&f[0].replace(a,function(){for(var e=1;e<arguments.length-2;e++)typeof arguments[e]=="undefined"&&(f[e]=void 0)}),f.length>1&&f.index<i.length&&h.apply(s,X(f,1)),c=f[0].length,u=l;if(s.length>=d)break}p.lastIndex===f.index&&p.lastIndex++,f=p.exec(i)}return u===i.length?(c||!p.test(""))&&Q(s,""):Q(s,$(i,u)),s.length>d?X(s,0,d):s}}():"0".split(void 0,0).length&&(u.split=function(t,n){return typeof t=="undefined"&&n===0?[]:J(this,t,n)});var En=u.replace,Sn=function(){var e=[];return"x".replace(/x(.)?/g,function(t,n){Q(e,n)}),e.length===1&&typeof e[0]=="undefined"}();Sn||(u.replace=function(t,n){var r=S(n),i=A(t)&&/\)[*?]/.test(t.source);if(!r||!i)return En.call(this,t,n);var s=function(e){var r=arguments.length,i=t.lastIndex;t.lastIndex=0;var s=t.exec(e)||[];return t.lastIndex=i,Q(s,arguments[r-2],arguments[r-1]),n.apply(this,s)};return En.call(this,t,s)});var xn=u.substr,Tn="".substr&&"0b".substr(-1)!=="b";F(u,{substr:function(t,n){var r=t;return t<0&&(r=y(this.length+t,0)),xn.call(this,r,n)}},Tn);var Nn="	\n\f\r   ᠎             　\u2028\u2029﻿",Cn="​",kn="["+Nn+"]",Ln=new RegExp("^"+kn+kn+"*"),An=new RegExp(kn+kn+"*$"),On=u.trim&&(Nn.trim()||!Cn.trim());F(u,{trim:function(){if(typeof this=="undefined"||this===null)throw new TypeError("can't convert "+this+" to object");return o(this).replace(Ln,"").replace(An,"")}},On);var Mn=m.bind(String.prototype.trim),_n=u.lastIndexOf&&"abcあい".lastIndexOf("あい",2)!==-1;F(u,{lastIndexOf:function(t){if(typeof this=="undefined"||this===null)throw new TypeError("can't convert "+this+" to object");var n=o(this),r=o(t),i=arguments.length>1?a(arguments[1]):NaN,s=q(i)?Infinity:R.ToInteger(i),u=b(y(s,0),n.length),f=r.length,l=u+f;while(l>0){l=y(0,l-f);var c=K($(n,l,u+f),r);if(c!==-1)return l+c}return-1}},_n);var Dn=u.lastIndexOf;F(u,{lastIndexOf:function(t){return Dn.apply(this,arguments)}},u.lastIndexOf.length!==1);if(parseInt(Nn+"08")!==8||parseInt(Nn+"0x16")!==22)parseInt=function(e){var t=/^[\-+]?0[xX]/;return function(r,i){var s=Mn(String(r)),o=a(i)||(t.test(s)?16:10);return e(s,o)}}(parseInt);1/parseFloat("-0")!==-Infinity&&(parseFloat=function(e){return function(n){var r=Mn(String(n)),i=e(r);return i===0&&$(r,0,1)==="-"?0:i}}(parseFloat));if(String(new RangeError("test"))!=="RangeError: test"){var Pn=function In(){if(typeof this=="undefined"||this===null)throw new TypeError("can't convert "+this+" to object");var e=this.name;typeof e=="undefined"?e="Error":typeof e!="string"&&(e=o(e));var t=this.message;return typeof t=="undefined"?t="":typeof t!="string"&&(t=o(t)),e?t?e+": "+t:e:t};Error.prototype.toString=Pn}if(j){var Hn=function(e,t){if(G(e,t)){var n=Object.getOwnPropertyDescriptor(e,t);n.configurable&&(n.enumerable=!1,Object.defineProperty(e,t,n))}};Hn(Error.prototype,"message"),Error.prototype.message!==""&&(Error.prototype.message=""),Hn(Error.prototype,"name")}if(String(/a/mig)!=="/a/gim"){var Bn=function qn(){var e="/"+this.source+"/";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),e};RegExp.prototype.toString=Bn}}),function(e){var t="5.1",n,r;r="volatile",n=e.store=function(e,t,r,i){r=r||{},i=r.type&&r.type in n.types?r.type:n.type;if(!i||!n.types[i]){n.log("Cannot save/load value. Invalid storage type selected: "+i,"ERR");return}return n.log("Accessing "+i+" storage"),n.types[i](e,t,r)},n.prefix="__shelf__",n.verbosity=0,n.types={};try{Object.defineProperty(n,"type",{set:function(e){return"undefined"==typeof n.types[e]?(n.log("Cannot set store.type to an invalid type: "+e),!1):(r=e,e)},get:function(){return r},configurable:!1,enumerable:!0})}catch(i){n.type=r}n.addType=function(e,t){n.types[e]=t,n[e]=function(t,r,i){return i=i||{},i.type=e,n(t,r,i)};if(!n.type||n.type==="volatile")n.type=e},n.onquotaerror=undefined,n.error=function(){console.log("shelf quota exceeded"),"function"==typeof n.onquotaerror&&n.onquotaerror(null)},n.log=function(e){n.verbosity>0&&console.log("Shelf v."+t+": "+e)},n.isPersistent=function(){return n.types?n.type==="volatile"?!1:!0:!1};try{Object.defineProperty(n,"persistent",{set:function(){},get:n.isPersistent,configurable:!1})}catch(i){n.persistent=!1}n.decycle=function(e){return JSON&&JSON.decycle&&"function"==typeof JSON.decycle&&(e=JSON.decycle(e)),e},n.retrocycle=function(e){return JSON&&JSON.retrocycle&&"function"==typeof JSON.retrocycle&&(e=JSON.retrocycle(e)),e},n.stringify=function(e){if(!JSON||!JSON.stringify||"function"!=typeof JSON.stringify)throw new Error("JSON.stringify not found. Received non-stringvalue and could not serialize.");return e=n.decycle(e),JSON.stringify(e)},n.parse=function(e){if("undefined"==typeof e)return undefined;if(JSON&&JSON.parse&&"function"==typeof JSON.parse)try{e=JSON.parse(e)}catch(t){n.log("Error while parsing a value: "+t,"ERR"),n.log(e)}return e=n.retrocycle(e),e},function(){function r(e){return n.parse(n.stringify(e))}var e={},t={};n.addType("volatile",function(n,i,s){return n?i===undefined?r(e[n]):(t[n]&&(clearTimeout(t[n]),delete t[n]),i===null?(delete e[n],null):(e[n]=i,s.expires&&(t[n]=setTimeout(function(){delete e[n],delete t[n]},s.expires)),i)):r(e)})}()}("undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports:this),function(e){function r(e,r){t.addType(e,function(i,s,o){var u,a,f,l,c=s,h=(new Date).getTime();if(!i){c={},l=[],f=0;try{i=r.length;while(i=r.key(f++))n.test(i)&&(a=t.parse(r.getItem(i)),a.expires&&a.expires<=h?l.push(i):c[i.replace(rprefix,"")]=a.data);while(i=l.pop())r.removeItem(i)}catch(p){}return c}i=t.prefix+i;if(s===undefined){u=r.getItem(i),a=u?t.parse(u):{expires:-1};if(!(a.expires&&a.expires<=h))return a.data;r.removeItem(i)}else if(s===null)r.removeItem(i);else{a=t.stringify({data:s,expires:o.expires?h+o.expires:null});try{r.setItem(i,a)}catch(p){t[e]();try{r.setItem(i,a)}catch(p){throw t.error()}}}return c})}var t=e.store;if(!t)throw new Error("amplify.shelf.js: shelf.js core not found.");if("undefined"==typeof window)throw new Error("amplify.shelf.js:  window object not found.");var n=new RegExp("^"+t.prefix);for(var i in{localStorage:1,sessionStorage:1})try{window[i].setItem(t.prefix,"x"),window[i].removeItem(t.prefix),r(i,window[i])}catch(s){}if(!t.types.localStorage&&window.globalStorage)try{r("globalStorage",window.globalStorage[window.location.hostname]),t.type==="sessionStorage"&&(t.type="globalStorage")}catch(s){}(function(){if(t.types.localStorage)return;var e=document.createElement("div"),n=t.prefix;e.style.display="none",document.getElementsByTagName("head")[0].appendChild(e);try{e.addBehavior("#default#userdata"),e.load(n)}catch(r){e.parentNode.removeChild(e);return}t.addType("userData",function(r,i,s){e.load(n);var o,u,a,f,l,c=i,h=(new Date).getTime();if(!r){c={},l=[],f=0;while(o=e.XMLDocument.documentElement.attributes[f++])u=t.parse(o.value),u.expires&&u.expires<=h?l.push(o.name):c[o.name]=u.data;while(r=l.pop())e.removeAttribute(r);return e.save(n),c}r=r.replace(/[^\-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-"),r=r.replace(/^-/,"_-");if(i===undefined){o=e.getAttribute(r),u=o?t.parse(o):{expires:-1};if(!(u.expires&&u.expires<=h))return u.data;e.removeAttribute(r)}else i===null?e.removeAttribute(r):(a=e.getAttribute(r),u=t.stringify({data:i,expires:s.expires?h+s.expires:null}),e.setAttribute(r,u));try{e.save(n)}catch(p){a===null?e.removeAttribute(r):e.setAttribute(r,a),t.userData();try{e.setAttribute(r,u),e.save(n)}catch(p){throw a===null?e.removeAttribute(r):e.setAttribute(r,a),t.error()}}return c})})()}(this),function(e){var t=e.JSUS={};t._classes={},"undefined"==typeof console&&(console={}),"undefined"==typeof console.log&&(console.log=function(){}),t.log=function(e){console.log(e)},t.extend=function(e,n){var r,i;if("object"!=typeof e&&"function"!=typeof e)return n;"undefined"==typeof n&&(n=n||this,"function"==typeof e?(r=e.toString(),r=r.substr("function ".length),r=r.substr(0,r.indexOf("("))):r=e.constructor||e.__proto__.constructor,r&&(this._classes[r]=e));for(i in e)e.hasOwnProperty(i)&&(typeof n[i]!="object"?n[i]=e[i]:t.extend(e[i],n[i]));return e.prototype&&t.extend(e.prototype,n.prototype||n),n},t.require=t.get=function(e){return"undefined"==typeof t.clone?(t.log("JSUS.clone not found. Cannot continue."),!1):"undefined"==typeof e?t.clone(t._classes):"undefined"==typeof t._classes[e]?(t.log("Could not find class "+e),!1):t.clone(t._classes[e])},t.isNodeJS=function(){return"undefined"!=typeof module&&"undefined"!=typeof module.exports&&"function"==typeof require},t.isNodeJS()&&(require("./lib/compatibility"),require("./lib/obj"),require("./lib/array"),require("./lib/time"),require("./lib/eval"),require("./lib/dom"),require("./lib/random"),require("./lib/parse"),require("./lib/queue"),require("./lib/fs"))}("undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports:window),function(JSUS){"use strict";function COMPATIBILITY(){}COMPATIBILITY.compatibility=function(){var support={};try{Object.defineProperty({},"a",{enumerable:!1,value:1}),support.defineProperty=!0}catch(e){support.defineProperty=!1}try{eval("({ get x(){ return 1 } }).x === 1"),support.setter=!0}catch(err){support.setter=!1}try{var value;eval("({ set x(v){ value = v; } }).x = 1"),support.getter=!0}catch(err){support.getter=!1}return support},JSUS.extend(COMPATIBILITY)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function t(){}Array.prototype.filter||(Array.prototype.filter=function(e){if(this===void 0||this===null)throw new TypeError;var t=new Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;var r=[],i=arguments[1];for(var s=0;s<n;s++)if(s in t){var o=t[s];e.call(i,o,s,t)&&r.push(o)}return r}),t.isArray=function(e){return"function"==typeof e?e:function(e){return e?Object.prototype.toString.call(e)==="[object Array]":!1}}(Array.isArray),t.seq=function(t,n,r,i){var s,o;if("number"!=typeof t)return!1;if(t===Infinity)return!1;if("number"!=typeof n)return!1;if(n===Infinity)return!1;if(t===n)return[t];if(r===0)return!1;if(!e.inArray(typeof r,["undefined","number"]))return!1;r=r||1,i=i||function(e){return e},s=t,o=[];if(t<n)while(s<=n)o.push(i(s)),s+=r;else while(s>=n)o.push(i(s)),s-=r;return o},t.each=function(e,t,n){if("object"!=typeof e)return!1;if(!t)return!1;n=n||this;var r,i=e.length;for(r=0;r<i;r++)t.call(n,e[r]);return!0},t.map=function(){var n,r,i,s,o,u,a;u=arguments[0],a=arguments[1];if(!t.isArray(u)){e.log("ARRAY.map: first parameter must be array. Found: "+u);return}if("function"!=typeof a){e.log("ARRAY.map: second parameter must be function. Found: "+a);return}r=arguments.length;if(r===3)i=[null,arguments[2]];else if(r===4)i=[null,arguments[2],arguments[3]];else{r-=1,i=new Array(r);for(n=1;n<r;n++)i[n]=arguments[n+1]}s=[],r=u.length;for(n=0;n<r;n++)i[0]=u[n],o=a.apply(this,i),"undefined"!=typeof o&&s.push(o);return s},t.removeElement=function(t,n){var r,i;if("undefined"==typeof t||!n)return!1;"object"==typeof t?r=e.equals:r=function(e,t){return e===t};for(i=0;i<n.length;i++)if(r(t,n[i]))return n.splice(i,1);return!1},t.inArray=function(t,n){var r,i,s;if(!n)return!1;r=e.equals,s=n.length;for(i=0;i<s;i++)if(r.call(this,t,n[i]))return!0;return!1},t.in_array=function(e,n){return console.log("***ARRAY.in_array is deprecated. Use ARRAY.inArray instead.***"),t.inArray(e,n)},t.getNGroups=function(e,n){return t.getGroupsSizeN(e,Math.floor(e.length/n))},t.getGroupsSizeN=function(e,t){var n=e.slice(0),r=n.length,i=n.length,s=[],o,u,a=[],f=0;for(o=0;o<i;o++)u=Math.floor(Math.random()*r),f>=t&&(s.push(a),f=0,a=[]),a.push(n[u]),n.splice(u,1),r=n.length,f++;return a.length>0&&s.push(a),s},t._latinSquare=function(t,n,r){r="undefined"==typeof r?!0:r;if(t===n&&!r)return!1;var i=[],s=[];for(var o=0;o<t;o++)i[o]=o;var u=null,a=0,f=t,l=[];r||(f=t-1);for(o=0;o<n;o++){do u=e.randomInt(a,f);while(e.inArray(u,l));l.push(u),u==1?(s[o]=i.slice(u),s[o].push(0)):s[o]=i.slice(u).concat(i.slice(0,u))}return s},t.latinSquare=function(e,n){return n||(n=e),!e||e<0||n<0?!1:(n>e&&(n=e),t._latinSquare(e,n,!0))},t.latinSquareNoSelf=function(e,n){return n||(n=e-1),!e||e<0||n<0?!1:(n>e&&(n=e-1),t._latinSquare(e,n,!1))},t.generateCombinations=function n(e,t){var r,i,s,o,u;s=[];for(r=0;r<e.length;r++)if(t===1)s.push([e[r]]);else{o=n(e.slice(r+1,e.length),t-1);for(i=0;i<o.length;i++)u=o[i],u.unshift(e[r]),s.push(u)}return s},t.matchN=function(e,n,r){var i,s,o,u,a,f;if(!e)return;if(!n)return e;i=[],a=e.length,f=[];for(s=0;s<a;s++)o=e.slice(0),o.splice(s,1),r&&(o=t.arrayDiff(o,f)),u=t.getNRandom(o,n),f=f.concat(u),u.splice(0,0,e[s]),i.push(u),u=[];return i},t.rep=function(t,n){var r,i;if(!t)return;if(!n)return t.slice(0);if(n<1){e.log("times must be greater or equal 1","ERR");return}r=1,i=t.slice(0);for(;r<n;r++)i=i.concat(t);return i},t.stretch=function(n,r){var i,s,o,u;if(!n)return;if(!r)return n.slice(0);if("number"==typeof r){if(r<1){e.log("times must be greater or equal 1","ERR");return}r=t.rep([r],n.length)}i=[];for(s=0;s<n.length;s++){o=r[s%r.length];for(u=0;u<o;u++)i.push(n[s])}return i},t.arrayIntersect=function(t,n){return t.filter(function(t){return e.inArray(t,n)})},t.arrayDiff=function(t,n){return t.filter(function(t){return!e.inArray(t,n)})},t.shuffle=function(e){var t,n,r,i,s;if(!e)return;t=Array.prototype.slice.call(e),n=e.length-1;for(s=n;s>0;s--)r=Math.floor(Math.random()*(s+1)),i=t[r],t[r]=t[s],t[s]=i;return t},t.getNRandom=function(e,n){return t.shuffle(e).slice(0,n)},t.distinct=function(e){var n=[];return e?(t.each(e,function(e){t.inArray(e,n)||n.push(e)}),n):n},t.transpose=function(e){if(!e)return;var n,r,i,s,o=[];n=e.length||0,r=t.isArray(e[0])?e[0].length:0;if(n===0||r===0)return o;for(i=0;i<r;i++){o[i]=[];for(s=0;s<n;s++)o[i][s]=e[s][i]}return o},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function t(){}function r(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch(r){e[t]=n}}var n=null;"undefined"!=typeof e.compatibility&&(n=e.compatibility()),t.createObj=function(){return typeof Object.create!="function"?function(){function e(){}var t=Object.prototype.hasOwnProperty;return function(n){if(typeof n!="object")throw new TypeError("Object prototype may only be an Object or null");e.prototype=n;var r=new e;e.prototype=null;if(arguments.length>1){var i=new Object(arguments[1]);for(var s in i)t.call(i,s)&&(r[s]=i[s])}return r}}():Object.create}(),t.equals=function(e,n){var r,i,s,o;r=typeof e,i=typeof n;if(r!==i)return!1;if("undefined"===r||"undefined"===i)return e===n;if(e===null||n===null)return e===n;if("number"===r&&isNaN(e)&&"number"===i&&isNaN(n))return isNaN(e)&&isNaN(n);s={number:"",string:"","boolean":""};if(r in s)return e===n;if("function"===r)return e.toString()===n.toString();for(o in e)if(e.hasOwnProperty(o)){if("undefined"==typeof n[o]&&"undefined"!=typeof e[o])return!1;if(!n[o]&&e[o])return!1;if("function"==typeof e[o]){if(e[o].toString()!==n[o].toString())return!1}else if(!t.equals(e[o],n[o]))return!1}for(o in n)if(n.hasOwnProperty(o)){if("undefined"==typeof e[o]&&"undefined"!=typeof n[o])return!1;if(!e[o]&&n[o])return!1}return!0},t.isEmpty=function(e){var t;if(!e)return!0;if("string"==typeof e)return e.trim()==="";if("number"==typeof e)return!1;if("function"==typeof e)return!1;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},t.size=t.getListSize=function(e){var t,n;if(!e)return 0;if("number"==typeof e)return 0;if("string"==typeof e)return 0;t=0;for(n in e)e.hasOwnProperty(n)&&t++;return t},t._obj2Array=function(e,n,r,i){var s,o;if("object"!=typeof e)return[e];if(r){i="undefined"!=typeof i?i:1;if(i>r)return[e];i+=1}s=[];for(o in e)e.hasOwnProperty(o)&&(n&&s.push(o),"object"==typeof e[o]?s=s.concat(t._obj2Array(e[o],n,r,i)):s.push(e[o]));return s},t.obj2Array=function(e,n){return t._obj2Array(e,!1,n)},t.obj2KeyedArray=t.obj2KeyArray=function(e,n){return t._obj2Array(e,!0,n)},t.obj2QueryString=function(e){var t,n;if("object"!=typeof e)throw new TypeError("JSUS.objectToQueryString: obj must be object.");t=[];for(n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return"?"+t.join("&")},t.keys=t.objGetAllKeys=function(e,n,r){var i,s;if(!e)return[];n="number"==typeof n&&n>=0?n:0,r="number"==typeof r&&r>=0?r:0,i=[];for(s in e)e.hasOwnProperty(s)&&(i.push(s),r<n&&"object"==typeof e[s]&&(i=i.concat(t.objGetAllKeys(e[s],r+1))));return i},t.implode=t.implodeObj=function(e){var t,n,r;if(!e)return[];t=[];for(n in e)e.hasOwnProperty(n)&&(r={},r[n]=e[n],t.push(r));return t},t.clone=function(e){var i,s,o;if(!e)return e;if("number"==typeof e)return e;if("string"==typeof e)return e;if("boolean"==typeof e)return e;"function"==typeof e?i=function(){var t,n;t=arguments.length;if(!t)return e.call(i);if(t===1)return e.call(i,arguments[0]);if(t===2)return e.call(i,arguments[0],arguments[1]);n=new Array(t);for(s=0;s<t;s++)n[s]=arguments[s];return e.apply(i,n)}:i=Object.prototype.toString.call(e)==="[object Array]"?[]:{};for(s in e)e[s]&&"object"==typeof e[s]?o=t.clone(e[s]):o=e[s],e.hasOwnProperty(s)?i[s]=o:n&&n.defineProperty?Object.defineProperty(i,s,{value:o,writable:!0,configurable:!0}):r(i,s,o);return i},t.classClone=function(t,n){var r,i;if(n===0)return t;if(t&&"object"==typeof t){r=Object.prototype.toString.call(t)==="[object Array]"?[]:e.createObj(t.constructor.prototype);for(i in t)t.hasOwnProperty(i)&&(t[i]&&"object"==typeof t[i]?r[i]=e.classClone(t[i],n-1):r[i]=t[i]);return r}return e.clone(t)},t.join=function(e,n){var r,i;r=t.clone(e);if(!n)return r;for(i in r)r.hasOwnProperty(i)&&"undefined"!=typeof n[i]&&("object"==typeof n[i]?r[i]=t.join(r[i],n[i]):r[i]=n[i]);return r},t.merge=function(e,n){var r,i;if(!e&&!n)return!1;if(!e)return t.clone(n);if(!n)return t.clone(e);r=t.clone(e);for(i in n)n.hasOwnProperty(i)&&(n[i]&&"object"==typeof n[i]?("object"!=typeof r[i]&&(Object.prototype.toString.call(n[i])==="[object Array]"?r[i]=[]:r[i]={}),r[i]=t.merge(r[i],n[i])):r[i]=n[i]);return r},t.mixin=function(e,t){var n;if(!e&&!t)return;if(!e)return t;if(!t)return e;for(n in t)e[n]=t[n]},t.mixout=function(e,t){var n;if(!e&&!t)return;if(!e)return t;if(!t)return e;for(n in t)"undefined"==typeof e[n]&&(e[n]=t[n])},t.mixcommon=function(e,t){var n;if(!e&&!t)return;if(!e)return t;if(!t)return e;for(n in t)"undefined"!=typeof e[n]&&(e[n]=t[n])},t.mergeOnKey=function(e,n,r){var i,s;i=t.clone(e);if(!n||!r)return i;for(s in n)if(n.hasOwnProperty(s)){if(!i[s]||"object"!=typeof i[s])i[s]={};i[s][r]=n[s]}return i},t.subobj=function(e,n){var r,i,s;if(!e)return!1;r={};if(!n)return r;n instanceof Array||(n=[n]);for(i=0;i<n.length;i++)s=n[i],e.hasOwnProperty(s)?r[s]=e[s]:t.hasOwnNestedProperty(s,e)&&t.setNestedValue(s,t.getNestedValue(s,e),r);return r},t.skim=function(e,n){var r,i;if(!e)return!1;r=t.clone(e);if(!n)return r;n instanceof Array||(n=[n]);for(i=0;i<n.length;i++)r.hasOwnProperty(i)?delete r[i]:t.deleteNestedKey(n[i],r);return r},t.setNestedValue=function(n,r,i){var s,o;return n?(i="object"==typeof i?i:{},s=n.split("."),s.length===1?(i[n]=r,i):(o=s.shift(),i[o]=t.setNestedValue(s.join("."),r,i[o]),i)):(e.log("Cannot set value of undefined property","ERR"),!1)},t.getNestedValue=function(e,n){var r,i;if(!n)return;return r=e.split("."),r.length===1?n[e]:(i=r.shift(),t.getNestedValue(r.join("."),n[i]))},t.deleteNestedKey=function(e,n){var r,i;if(!n)return;return r=e.split("."),r.length===1?(delete n[e],!0):(i=r.shift(),"undefined"==typeof n[i]?!1:t.deleteNestedKey(r.join("."),n[i]))},t.hasOwnNestedProperty=function(e,n){var r,i;return n?(r=e.split("."),r.length===1?n.hasOwnProperty(e):(i=r.shift(),t.hasOwnNestedProperty(r.join("."),n[i]))):!1},t.split=function(){var t,n,r,i,s,o;return t=function(t,n,i){var o,u,a,f;f=e.clone(r);switch(i.length){case 0:f[s]=e.clone(t);break;case 1:f[s][i[0]]=e.clone(t);break;case 2:f[s][i[0]]={},f[s][i[0]][i[1]]=e.clone(t);break;default:o=-1,u=i.length-1,a=f[s];for(;++o<u;)a[i[o]]={},a=a[i[o]];a[i[i.length-1]]=e.clone(t)}n.push(f);return},n=function(r,s,u,a){var f,l;if(i&&u>=i)t(r,s,a);else{l=o||!e.isArray(r);for(f in r)r.hasOwnProperty(f)&&("object"==typeof r[f]&&i&&u+1<=i?n(r[f],s,u+1,l?a.concat(f):a):t(r[f],s,l?a.concat(f):a))}},function(t,u,a,f){var l;if("object"!=typeof t)throw new TypeError("JSUS.split: o must be object. Found: "+t);if("string"!=typeof u||u.trim()==="")throw new TypeError("JSUS.split: key must a non-empty string. Found: "+u);if(a&&("number"!=typeof a||a<0))throw new TypeError("JSUS.split: l must a non-negative number or undefined. Found: "+a);return r=e.clone(t),"object"!=typeof t[u]?[r]:(l=[],s=u,r[u]={},i="undefined"==typeof a?1:a,o=f,n(t[u],l,0,[]),s=undefined,r=undefined,i=undefined,o=undefined,l)}}(),t.melt=function(e,t){var n={},r=t.length;for(var i=0;i<e.length;i++)n[e[i]]=t[i%r];return n},t.uniqueKey=function(t,n,r){var i,s;if(!t){e.log("Cannot find unique name in undefined object","ERR");return}s=1,n=""+(n||Math.floor(Math.random()*1e15)),r=r||1e6,i=n;while(t[i]){i=n+s,s++;if(s>r)return}return i},t.augment=function(e,n,r){var i,s;r=r||t.keys(e);for(i=0;i<r.length;i++)s=r[i],"undefined"!=typeof e[s]&&Object.prototype.toString.call(e[s])!=="[object Array]"&&(e[s]=[e[s]]),"undefined"!==n[s]&&(e[s]||(e[s]=[]),e[s].push(n[s]))},t.pairwiseWalk=function(e,t,n){var r,i;if(!e&&!t)return;if(!e)return t;if(!t)return e;i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=t.hasOwnProperty(r)?n(e[r],t[r]):n(e[r]));for(r in t)t.hasOwnProperty(r)&&"undefined"==typeof i[r]&&(i[r]=n(undefined,t[r]));return i},t.getKeyByValue=function(e,n,r){var i,s;if("object"!=typeof e)throw new TypeError("OBJ.getKeyByValue: obj must be object.");r&&(s=[]);for(i in e)if(e.hasOwnProperty(i)&&t.equals(n,e[i])){if(!r)return i;s.push(i)}return s},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e){"use strict";function t(){}function n(e){var t=function(e,t,n,r){var i=parseInt(t,10),s=parseInt(r,10);return n=="*"?i*s:i/s},n=function(e,t,n,r){var i=parseInt(t,10),s=parseInt(r,10);return n=="-"?i-s:i+s},r=function(e,t,n,r){var i=parseInt(t,10),s=parseInt(r,10);return i%s};while(e.match(/([-+]?\d+) *([*\/]) *([-+]?\d+)/g))e=e.replace(/([-+]?\d+) *([*\/]) *([-+]?\d+)/,t);while(e.match(/([-+]?\d+) *([-+]) *([-+]?\d+)/g))e=e.replace(/([-+]?\d+) *([-+]) *([-+]?\d+)/,n);while(e.match(/([-+]?\d+) *% *([-+]?\d+)/g))e=e.replace(/([-+]?\d+) *% *([-+]?\d+)/,r);return e}t.stringify_prefix="!?_",t.marker_func=t.stringify_prefix+"function",t.marker_null=t.stringify_prefix+"null",t.marker_und=t.stringify_prefix+"undefined",t.marker_nan=t.stringify_prefix+"NaN",t.marker_inf=t.stringify_prefix+"Infinity",t.marker_minus_inf=t.stringify_prefix+"-Infinity",t.getQueryString=function(e,t){var n,r;if(t&&"string"!=typeof t)throw new TypeError("JSUS.getQueryString: referer must be string or undefined.");return t=t||window.location.search,"undefined"==typeof e?t:(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=n.exec(t),r===null?!1:decodeURIComponent(r[1].replace(/\+/g," ")))},t.tokenize=function(t,n,r){var i,s;if(!t)return;return!n||!n.length?[t]:(r=r||{},i="[",e.each(n,function(e){e===" "&&(e="\\s"),i+=e}),i+="]+",s=new RegExp(i),t.split(s,r.limit))},t.stringify=function(e,n){return JSON.stringify(e,function(e,n){var r=typeof n;return"function"===r?t.stringify_prefix+n.toString():"undefined"===r?t.marker_und:n===null?t.marker_null:"number"===r&&isNaN(n)?t.marker_nan:n===Number.POSITIVE_INFINITY?t.marker_inf:n===Number.NEGATIVE_INFINITY?t.marker_minus_inf:n},n)},t.stringifyAll=function(e,n){var r;if("object"==typeof e)for(r in e)e.hasOwnProperty(r)||("object"==typeof e[r]?e[r]=t.stringifyAll(e[r]):e[r]=e[r]);return t.stringify(e)},t.parse=function(){function f(e){var t;if("object"!=typeof e)return l(e);for(t in e)e.hasOwnProperty(t)&&("object"==typeof e[t]?f(e[t]):e[t]=l(e[t]));return e}function l(f){var l;l=typeof f;if(l==="string"){if(f.substring(0,n)!==t.stringify_prefix)return f;if(f.substring(0,r)===t.marker_func)return e.eval(f.substring(n));if(f.substring(0,i)===t.marker_null)return null;if(f.substring(0,s)===t.marker_und)return undefined;if(f.substring(0,o)===t.marker_nan)return NaN;if(f.substring(0,u)===t.marker_inf)return Infinity;if(f.substring(0,a)===t.marker_minus_inf)return-Infinity}return f}var n=t.stringify_prefix.length,r=t.marker_func.length,i=t.marker_null.length,s=t.marker_und.length,o=t.marker_nan.length,u=t.marker_inf.length,a=t.marker_minus_inf.length;return function(e){return f(JSON.parse(e))}}(),t.isInt=function(e,n,r){var i,s;return i=/^-?\d+$/,i.test(e)?(s=parseInt(e,10),s!==parseFloat(e)?!1:t.isNumber(s,n,r)):!1},t.isFloat=function(e,n,r){var i;return i=/^-?\d*(\.\d+)?$/,i.test(e)?e.toString().indexOf(".")===-1?!1:t.isNumber(e,n,r):!1},t.isNumber=function(e,t,n){return isNaN(e)||!isFinite(e)?!1:(e=parseFloat(e),"number"==typeof t&&e<t?!1:"number"==typeof n&&e>n?!1:e)},t.range=function(r,i){var s,o,u,a,f,l,c,h,p,d,v;a=[];if("undefined"==typeof r)return a;if("number"==typeof r)r=""+r;else if("string"!=typeof r)throw new TypeError("PARSE.range: expr must be string, number, undefined.");if("undefined"==typeof i)i=r;else if(e.isArray(i)){if(i.length===0)return a;f=Math.min.apply(null,i),l=Math.max.apply(null,i)}else if("object"==typeof i){if("function"!=typeof i.next)throw new TypeError("PARSE.range: available.next must be function.");if("function"!=typeof i.isFinished)throw new TypeError("PARSE.range: available.isFinished must be function.");if("number"!=typeof i.begin)throw new TypeError("PARSE.range: available.begin must be number.");if("number"!=typeof i.end)throw new TypeError("PARSE.range: available.end must be number.");f=i.begin,l=i.end}else{if("string"!=typeof i)throw new TypeError("PARSE.range: available must be string, array, object or undefined.");i=n(i),h=i.match(/([-+]?\d+)/g);if(h===null)throw new Error("PARSE.range: no numbers in available: "+i);c=Math.min.apply(null,h),i=t.range(i,{begin:c,end:Math.max.apply(null,h),value:c,next:function(){return this.value++},isFinished:function(){return this.value>this.end}}),f=Math.min.apply(null,i),l=Math.max.apply(null,i)}r=r.replace(/end/g,parseInt(l,10)),r=r.replace(/begin/g,parseInt(f,10)),r=n(r),r=r.replace(/([-+]?\d+\.\d+)/g,function(e,t){return parseInt(t,10)}),p=/[^ \*\d<>=!\|&\.\[\],\(\)\-\+%]/g;if(r.match(p))throw new Error("PARSE.range: invalid characters found: "+r);r=r.replace(/([^& ]) *& *([^& ])/g,"$1&&$2"),r=r.replace(/([^| ]) *\| *([^| ])/g,"$1||$2"),r=r.replace(/([-+]?\d+)/g,"(x==$1)"),r=r.replace(/% *\(x==([-+]?\d+)\)/,"!(x%$1)"),r=r.replace(/!\(x%([-+]?\d+)\) *={1,} *\(x==([-+]?\d+)\)/g,"(x%$1==$2)"),r=r.replace(/([<>]=?) *\(x==([-+]?\d+)\)/g,"(x$1$2)"),r=r.replace(/\(x==([-+]?\d+)\)\.{2,}\(x==(\+?\d+)\)\.{2,}\(x==([-+]?\d+)\)/g,"(x>=$1&&x<=$3&&!((x- $1)%$2))"),r=r.replace(/\(x==([-+]?\d+)\)\.{2,}\(x==(-\d+)\)\.{2,}\(x==([-+]?\d+)\)/g,"(x<=$1&&x>=$3&&!((x- $1)%$2))"),r=r.replace(/\(x==([-+]?\d+)\)\.{2,}\(x==([-+]?\d+)\)/g,"(x>=$1&&x<=$2)"),r=r.replace(/([(\[]) *\(x==([-+]?\d+)\) *, *\(x==([-+]?\d+)\) *([\])])/g,function(e,t,n,r,i){return"(x>"+(t=="("?"":"=")+n+"&&x<"+(i==")"?"":"=")+r+")"}),r=r.replace("*",1),r=r.replace(/\s/g,""),r=r.replace(/\)[,] *(!*)\(/g,")||$1("),p=/[^ \d<>=!\|&,\(\)\-\+%x\.]/g,d=/[^ &!|\(] *\(/g,v=/\.[^\d]|[^\d]\./;if(r.match(p))throw new Error("PARSE.range: invalid characters found: "+r);if(r.match(d))throw new Error("PARSE.range: invalid character before opending bracket found: "+r);if(r.match(v))throw new Error("PARSE.range: invalid dot found: "+r);if(e.isArray(i)){s=-1,o=i.length;for(;++s<o;)u=parseInt(i[s],10),e.eval(r.replace(/x/g,u))&&a.push(u)}else while(!i.isFinished())u=parseInt(i.next(),10),e.eval(r.replace(/x/g,u))&&a.push(u);return a},"undefined"!=typeof Function.prototype.name?t.funcName=function(e){if("function"!=typeof e)throw new TypeError("PARSE.funcName: func must be function.");return e.name}:t.funcName=function(e){var t,n;if("function"!=typeof e)throw new TypeError("PARSE.funcName: func must be function.");return t=/function\s([^(]{1,})\(/,n=t.exec(e.toString()),n&&n.length>1?n[1].trim():""},e.extend(t)}("undefined"!=typeof JSUS?JSUS:module.parent.exports.JSUS),function(e,t,n){"use strict";function i(e,t){var n;n=this,e=e||{},this.nddbid=new E("nddbid",this),this.db=[],this.lastSelection=[],this.hashtray=new w,this.tags={},this.hooks={insert:[],remove:[],update:[]},this.nddb_pointer=0,this.query=new y,this.addDefaultFilters(),this.__userDefinedFilters={},this.__C={},this.__H={},this.__I={},this.__V={},this.__update={},this.__update.pointer=!1,this.__update.indexes=!1,this.__update.sort=!1,this.__shared={},this.__formats={},this.__defaultFormat=null,this.__wd=null,this.log=console.log,this.globalCompare=function(e,t){return-1},this.comparator("*",function(e,t,r,i){var s,o,u;for(s in e){o=n.getComparator(s),t[s]=t["*"],u=o(e,t);if(u===r)return u;if("undefined"!==i&&u===i)return u}return r===0?i===1?-1:1:r===1?i===0?-1:0:i===0?1:0}),"function"==typeof this.addDefaultFormats&&this.addDefaultFormats(),this.init(e),t&&this.importDB(t)}function s(e,t,n,r){var i,s;throw i="(?)",s=this._getConstrName()+"._analyzeQuery: "+e+". Malformed query: "+t||i+" "+n||i+" "+r||i+".",new Error(s)}function o(e,n){return t.obj2Array(e,1)}function u(e,n){return t.obj2KeyedArray(e,1)}function a(e,n){var r=t.getNestedValue(n,e);if("undefined"!=typeof r)return t.obj2Array(r,1)}function f(e,n){var r=t.subobj(e,n);if(!t.isEmpty(r))return t.obj2Array(r,1)}function l(e,n){var r=t.getNestedValue(n,e);if("undefined"!=typeof r)return n.split(".").concat(t.obj2KeyedArray(r))}function c(e,n){var r=t.subobj(e,n);if(!t.isEmpty(r))return t.obj2KeyedArray(r)}function h(e,n){var i,s;return"object"!=typeof e&&"function"!=typeof e&&this.throwErr("TypeError","insert","object or function expected, "+typeof e+" received"),"undefined"==typeof e._nddbid&&(i=t.uniqueKey(this.nddbid.resolve),i||this.throwErr("Error","insert","failed to create index: "+e),r?Object.defineProperty(e,"_nddbid",{value:i}):e._nddbid=i),this.nddbid.resolve[e._nddbid]=this.db.length,s=this.emit("insert",e),s===!1?!1:(this.db.push(e),n&&(this._indexIt(e,this.db.length-1),this._hashIt(e),this._viewIt(e)),!0)}function p(e,t,n,r,i){("string"!=typeof n||n.trim()==="")&&e.throwErr("TypeError",t,"file must be a non-empty string"),r&&"function"!=typeof r&&e.throwErr("TypeError",t,"cb must be function or undefined"),i&&"object"!=typeof i&&e.throwErr("TypeError",t,"options must be object or undefined")}function d(e){var t;return t=e.lastIndexOf("."),t<0?null:e.substr(t+1)}function v(e,t,n,r,i){var s,o;p(e,t,n,r,i),e.storageAvailable()||e.throwErr("Error","save","no persistent storage available"),i=i||{},o=d(n),s=m(e,t,o),s(e,n,r,i)}function m(e,t,n){var r,i;return n&&(r=e.getFormat(n)),r&&(r[t]||e.throwErr("Error",t,"format "+n+" found, "+"but method "+t+" not available"),r=r[t]),r||(i=e.getDefaultFormat(),i||e.throwErr("Error",t,"format "+n+" not "+"found and no default format specified"),r=e.getFormat(i,t),r||e.throwErr("Error",t,"format "+n+" not "+"found, but default format has no method "+t)),r}function g(e,n,r){"string"!=typeof n&&!t.isArray(n)&&!n.length&&e.throwErr("TypeError","addFormat","format must be a non-empty string or array"),"object"!=typeof r&&e.throwErr("TypeError","addFormat","obj must be object"),!r.save&&!r.saveSync&&e.throwErr("Error","addFormat","format must at least one save function: sync or async"),!r.load&&!r.loadSync&&e.throwErr("Error","addFormat","format must at least one load function: sync or async");if(r.save||r.load)"function"!=typeof r.save&&e.throwErr("TypeError","addFormat","save function is not a function"),"function"!=typeof r.load&&e.throwErr("TypeError","addFormat","load function is not a function");if(r.saveSync||r.loadSync)"function"!=typeof r.saveSync&&e.throwErr("TypeError","addFormat","saveSync function is not a function"),"function"!=typeof r.loadSync&&e.throwErr("TypeError","addFormat","loadSync function is not a function")}function y(){this.reset()}function b(e){return e.cb}function w(){this.resolve={}}function E(e,t){this.idx=e,this.nddb=t,this.resolve={},this.keys=[],this.resolveKeys={}}e.NDDB=i;if(!t)throw new Error("NDDB: missing dependency: JSUS.");var r=t.compatibility().defineProperty;i.decycle=function(e){return JSON&&JSON.decycle&&"function"==typeof JSON.decycle&&(e=JSON.decycle(e)),e},i.retrocycle=function(e){return JSON&&JSON.retrocycle&&"function"==typeof JSON.retrocycle&&(e=JSON.retrocycle(e)),e},i.prototype.addFilter=function(e,t){this.filters[e]=t,this.__userDefinedFilters[e]=this.filters[e]},i.prototype.addDefaultFilters=function(){function n(e,t,n,r){var i;return RegExp.escape=function(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},i=RegExp.escape(t),i=i.replace(/%/g,".*").replace(/_/g,"."),i=new RegExp("^"+i+"$",r),"object"==typeof e?function(t){var n,r;r=e.length;for(n=0;n<r;n++)if("undefined"!=typeof t[e[n]]&&i.test(t[e[n]]))return t}:e==="*"?function(e){var t;for(t in e)if("undefined"!=typeof e[t]&&i.test(e[t]))return e}:function(t){if("undefined"!=typeof t[e]&&i.test(t[e]))return t}}this.filters||(this.filters={});var e;e=this,this.filters.E=function(n,r,i){return"object"==typeof n?function(n){var i,s;for(i in n){s=e.getComparator(i),r[i]=r[0]["*"];if(s(n,r,1)>0){r[i]=r[1]["*"];if(s(n,r,-1)<0)return n}}if("undefined"!=typeof n[i])return n;if("undefined"!=typeof t.getNestedValue(i,n))return n}:function(e){if("undefined"!=typeof e[n])return e;if("undefined"!=typeof t.getNestedValue(n,e))return e}},this.filters["=="]=function(e,t,n){return function(e){if(n(e,t,0)===0)return e}},this.filters["!="]=function(e,t,n){return function(e){if(n(e,t,0)!==0)return e}},this.filters[">"]=function(e,t,n){return"object"==typeof e||e==="*"?function(e){if(n(e,t,1)===1)return e}:function(r){if("undefined"==typeof r[e])return;if(n(r,t,1)===1)return r}},this.filters[">="]=function(e,t,n){return"object"==typeof e||e==="*"?function(e){var r=n(e,t,0,1);if(r===1||r===0)return e}:function(r){if("undefined"==typeof r[e])return;var i=n(r,t,0,1);if(i===1||i===0)return r}},this.filters["<"]=function(e,t,n){return"object"==typeof e||e==="*"?function(e){if(n(e,t,-1)===-1)return e}:function(r){if("undefined"==typeof r[e])return;if(n(r,t,-1)===-1)return r}},this.filters["<="]=function(e,t,n){return"object"==typeof e||e==="*"?function(e){var r=n(e,t,0,-1);if(r===-1||r===0)return e}:function(r){if("undefined"==typeof r[e])return;var i=n(r,t,0,-1);if(i===-1||i===0)return r}},this.filters["><"]=function(t,n,r){return"object"==typeof t?function(e){var i,s;s=t.length;for(i=0;i<s;i++)if(r(e,n[0],1)>0&&r(e,n[1],-1)<0)return e}:t==="*"?function(t){var r,i;for(r in t){i=e.getComparator(r),n[r]=n[0]["*"];if(i(t,n,1)>0){n[r]=n[1]["*"];if(i(t,n,-1)<0)return t}}}:function(e){if(r(e,n[0],1)>0&&r(e,n[1],-1)<0)return e}},this.filters["<>"]=function(e,t,n){return"object"==typeof e||e==="*"?function(e){if(n(e,t[0],-1)<0||n(e,t[1],1)>0)return e}:function(r){if("undefined"==typeof r[e])return;if(n(r,t[0],-1)<0||n(r,t[1],1)>0)return r}},this.filters["in"]=function(e,t,n){return"object"==typeof e?function(e){var r,i;i=t.length;for(r=0;r<i;r++)if(n(e,t[r],0)===0)return e}:function(r){var i,s,o;s={},o=t.length;for(i=0;i<o;i++){s[e]=t[i];if(n(r,s,0)===0)return r}}},this.filters["!in"]=function(e,t,n){return"object"==typeof e?function(e){var r,i;i=t.length;for(r=0;r<i;r++)if(n(e,t[r],0)===0)return;return e}:function(r){var i,s,o;s={},o=t.length;for(i=0;i<o;i++){s[e]=t[i];if(n(r,s,0)===0)return}return r}},this.filters.LIKE=function(t,r,i){return n(t,r,i)},this.filters.iLIKE=function(t,r,i){return n(t,r,i,"i")}},i.prototype.throwErr=function(e,t,n){var r,i;throw"object"==typeof n?i=n.stack||n:"string"==typeof n&&(i=n),i=i||"generic error",r=this._getConstrName(),t&&(r=r+"."+t),r=r+": "+i+".",e==="TypeError"?new TypeError(r):new Error(r)},i.prototype.init=function(e){var t,n,r,i;e=e||{},this.__options=e,e.tags&&("object"!=typeof e.tags&&(i="options.tag must be object or undefined",this.throwErr("TypeError","init",i)),this.tags=e.tags),"undefined"!=typeof e.nddb_pointer&&("number"!=typeof e.nddb_pointer&&(i="options.nddb_pointer must be number or undefined",this.throwErr("TypeError","init",i)),this.nddb_pointer=e.nddb_pointer),e.hooks&&("object"!=typeof e.hooks&&(i="options.hooks must be object or undefined",this.throwErr("TypeError","init",i)),this.hooks=e.hooks),e.globalCompare&&("function"!=typeof e.globalCompare&&(i="options.globalCompare must be function or undefined",this.throwErr("TypeError","init",i)),this.globalCompare=e.globalCompare),e.update&&("object"!=typeof e.update&&(i="options.update must be object or undefined",this.throwErr("TypeError","init",i)),"undefined"!=typeof e.update.pointer&&(this.__update.pointer=e.update.pointer),"undefined"!=typeof e.update.indexes&&(this.__update.indexes=e.update.indexes),"undefined"!=typeof e.update.sort&&(this.__update.sort=e.update.sort));if("object"==typeof e.filters){"object"!=typeof e.filters&&(i="options.filters must be object or undefined",this.throwErr("TypeError","init",i));for(t in e.filters)this.addFilter(t,e.filters[t])}if("object"==typeof e.shared)for(n in e.shared)e.shared.hasOwnProperty(n)&&(this.__shared[n]=e.shared[n]);delete this.__options.shared,e.log&&this.initLog(e.log,e.logCtx),e.C&&("object"!=typeof e.C&&(i="options.C must be object or undefined",this.throwErr("TypeError","init",i)),this.__C=e.C);if(e.H){"object"!=typeof e.H&&(i="options.H must be object or undefined",this.throwErr("TypeError","init",i));for(r in e.H)e.H.hasOwnProperty(r)&&this.hash(r,e.H[r])}if(e.I){"object"!=typeof e.I&&(i="options.I must be object or undefined",this.throwErr("TypeError","init",i)),this.__I=e.I;for(r in e.I)e.I.hasOwnProperty(r)&&this.index(r,e.I[r])}if(e.V){"object"!=typeof e.V&&(i="options.V must be object or undefined",this.throwErr("TypeError","init",i)),this.__V=e.V;for(r in e.V)e.V.hasOwnProperty(r)&&this.view(r,e.V[r])}if(e.formats){"object"!=typeof e.formats&&(i="options.formats must be object or undefined",this.throwErr("TypeError","init",i));for(r in e.formats)e.formats.hasOwnProperty(r)&&this.addFormat(r,e.formats[r])}e.defaultFormat&&this.setDefaultFormat(e.defaultFormat),e.wd&&"function"==typeof this.setWD&&this.setWD(e.wd)},i.prototype.initLog=function(e,t){"function"!=typeof e&&this.throwErr("TypeError","initLog","cb must be function"),t=t||this,"function"!=typeof t&&"object"!=typeof t&&this.throwErr("TypeError","initLog","ctx must be object or function"),this.log=function(){var n,r,i;i=arguments.length,n=new Array(i);for(r=0;r<i;r++)n[r]=arguments[r];return e.apply(t,n)}},i.prototype._getConstrName=function(){return this.constructor&&this.constructor.name?this.constructor.name:"NDDB"},i.prototype._autoUpdate=function(e){var n;n=e?t.merge(this.__update,e):this.__update,n.pointer&&(this.nddb_pointer=this.db.length-1),n.sort&&this.sort(),n.indexes&&this.rebuildIndexes()},i.prototype.importDB=function(e){var n,r;t.isArray(e)||this.throwErr("TypeError","importDB","db must be array. Found: "+e),n=-1,r=e.length;for(;++n<r;)h.call(this,e[n],this.__update.indexes);this._autoUpdate({indexes:!1})},i.prototype.insert=function(e){var t;return t=h.call(this,e,this.__update.indexes),t===!1?!1:(this._autoUpdate({indexes:!1}),e)},i.prototype.size=function(){return this.db.length},i.prototype.breed=function(e){return e&&!t.isArray(e)&&this.throwErr("TypeError","importDB","db must be array or undefined"),new this.constructor(this.cloneSettings(),e||this.fetch())},i.prototype.cloneSettings=function(e){var n,r,i,s,o;r=this.__options||{},i=!0,r.H=this.__H,r.I=this.__I,r.C=this.__C,r.V=this.__V,r.tags=this.tags,r.update=this.__update,r.hooks=this.hooks,r.globalCompare=this.globalCompare,r.filters=this.__userDefinedFilters,r.formats=this.__formats,r.defaultFormat=this.__defaultFormat,r.wd=this.__wd,r.log&&(s=r.log,delete r.log),r.logCtx&&(o=r.logCtx,delete r.logCtx),r=t.clone(r);for(n in e)if(e.hasOwnProperty(n)){if(n==="shared"){i=!1;continue}delete r[n]}return i&&(r.shared=this.__shared),s&&(r.log=s,this.__options.log=s),o&&(r.logCtx=o,this.__options.logCtx=o),r},i.prototype.toString=function(){var e,t;e="";for(t=0;t<this.db.length;t++)e+=this.db[t]+"\n";return e},i.prototype.stringify=function(e){var n,r,s,o,u;if(!this.size())return"[]";e="undefined"==typeof e?!0:e,n=e?0:4,r="[",o=-1,u=this.db.length;for(;++o<u;)s=i.decycle(this.db[o]),r+=t.stringify(s,n),o!==u-1&&(r+=", ");return r+="]",r},i.prototype.comparator=function(e,t){"string"!=typeof e&&this.throwErr("TypeError","comparator","d must be string"),"function"!=typeof t&&this.throwErr("TypeError","comparator","comparator must be function"),this.__C[e]=t},i.prototype.getComparator=function(e){var n,r,i,s;if("string"==typeof e)"undefined"!=typeof this.__C[e]?i=this.__C[e]:i=function(r,i){var s,o;return"undefined"==typeof r&&"undefined"==typeof i?0:"undefined"==typeof r?1:"undefined"==typeof i?-1:("undefined"!=typeof r[e]?s=r[e]:e.lastIndexOf(".")!==-1&&(s=t.getNestedValue(e,r)),"undefined"!=typeof i[e]?o=i[e]:e.lastIndexOf(".")!==-1&&(o=t.getNestedValue(e,i)),"undefined"==typeof s&&"undefined"==typeof o?0:"undefined"==typeof s?1:"undefined"==typeof o?-1:s>o?1:o>s?-1:o===s?0:1)};else{s={},r=e.length;for(n=0;n<r;n++)s[e[n]]=this.getComparator(e[n]);i=function(e,t,n,r){var i,o,u;for(i in s)if(s.hasOwnProperty(i)){if("undefined"==typeof e[i])continue;u={},u[i]=t,o=s[i](e,u);if(o===n)return o;if("undefined"!==r&&o===r)return o}return n===0?r===1?-1:1:n===1?r===0?-1:0:r===0?1:0}}return i},i.prototype.isReservedWord=function(e){return this[e]?!0:!1},i.prototype.index=function(e,t){"string"!=typeof e&&"number"!=typeof e&&this.throwErr("TypeError","index","idx must be string or number"),this.isReservedWord(e)&&this.throwErr("TypeError","index","idx is reserved word: "+e),"undefined"==typeof t?t=function(t){return t[e]}:"function"!=typeof t&&this.throwErr("TypeError","index","func must be function or undefined. Found: "+t),this.__I[e]=t,this[e]=new E(e,this)},i.prototype.view=function(e,t){var n;"string"!=typeof e&&"number"!=typeof e&&this.throwErr("TypeError","view","idx must be string or number"),this.isReservedWord(e)&&this.throwErr("TypeError","view","idx is reserved word: "+e),"undefined"==typeof t?t=function(t){return t[e]}:"function"!=typeof t&&this.throwErr("TypeError","view","func must be function or undefined. Found: "+t),n=this.cloneSettings({V:""}),this.__V[e]=t,this[e]=new i(n)},i.prototype.hash=function(e,t){"string"!=typeof e&&"number"!=typeof e&&this.throwErr("TypeError","hash","idx must be string or number"),this.isReservedWord(e)&&this.throwErr("TypeError","hash","idx is reserved word: "+e),"undefined"==typeof t?t=function(t){return t[e]}:"function"!=typeof t&&this.throwErr("TypeError","hash","func must be function or undefined. Found: "+t),this[e]={},this.__H[e]=t},i.prototype.resetIndexes=function(e){var n,r;r=e||t.merge({h:!0,v:!0,i:!0},e);if(r.h)for(n in this.__H)this.__H.hasOwnProperty(n)&&(this[n]={});if(r.v)for(n in this.__V)this.__V.hasOwnProperty(n)&&(this[n]=new this.constructor);if(r.i)for(n in this.__I)this.__I.hasOwnProperty(n)&&(this[n]=new E(n,this))},i.prototype.rebuildIndexes=function(){var e,n,r,i,s;e=!t.isEmpty(this.__H),n=!t.isEmpty(this.__I),r=!t.isEmpty(this.__V);if(!e&&!n&&!r)return;e&&!n&&!r?i=this._hashIt:!e&&n&&!r?i=this._indexIt:!e&&!n&&r?i=this._viewIt:e&&n&&!r?i=function(e,t){this._hashIt(e),this._indexIt(e,t)}:!e&&n&&r?i=function(e,t){this._indexIt(e,t),this._viewIt(e)}:e&&!n&&r?i=function(e,t){this._hashIt(e),this._viewIt(e)}:i=function(e,t){this._indexIt(e,t),this._hashIt(e),this._viewIt(e)},this.resetIndexes({h:e,v:r,i:n});for(s=0;s<this.db.length;s++)i.call(this,this.db[s],s)},i.prototype._indexIt=function(e,n,r){var i,s,o;if(!e||t.isEmpty(this.__I))return;for(o in this.__I)this.__I.hasOwnProperty(o)&&(i=this.__I[o],s=i(e),s!==r&&"undefined"!=typeof r&&"undefined"!=typeof this[o].resolve[r]&&this[o]._remove(r),"undefined"!=typeof s&&(this[o]||(this[o]=new E(o,this)),this[o]._add(s,n)))},i.prototype._viewIt=function(e){var n,r,s,o;if(!e||t.isEmpty(this.__V))return!1;for(s in this.__V)if(this.__V.hasOwnProperty(s)){n=this.__V[s],r=n(e);if("undefined"==typeof r){if(!this[s])continue;"undefined"!=typeof this[s].nddbid.resolve[e._nddbid]&&this[s].nddbid.remove(e._nddbid);continue}this[s]||(o=this.cloneSettings({V:!0,hooks:!0}),this[s]=new i(o)),this[s].insert(e)}},i.prototype._hashIt=function(e){var n,r,s,o,u;if(!e||t.isEmpty(this.__H))return!1;for(s in this.__H)if(this.__H.hasOwnProperty(s)){n=this.__H[s],r=n(e);if("undefined"==typeof r){u=this.hashtray.get(s,e._nddbid),u&&(this[s][u].nddbid.remove(e._nddbid),this.hashtray.remove(s,e._nddbid));continue}this[s]||(this[s]={}),this[s][r]||(o=this.cloneSettings({H:!0,hooks:!0}),this[s][r]=new i(o)),this[s][r].insert(e),this.hashtray.set(s,e._nddbid,r)}},i.prototype.on=function(e,t){"string"!=typeof e&&this.throwErr("TypeError","on","event must be string"),"function"!=typeof t&&this.throwErr("TypeError","on","func must be function"),this.hooks[e]||this.throwErr("TypeError","on","unknown event: "+e),this.hooks[e].push(t)},i.prototype.off=function(e,t){var n;"string"!=typeof e&&this.throwErr("TypeError","off","event must be string"),t&&"function"!=typeof t&&this.throwErr("TypeError","off","func must be function or undefined"),this.hooks[e]||this.throwErr("TypeError","off","unknown event: "+e);if(!this.hooks[e].length)return!1;if(!t)return this.hooks[e]=[],!0;for(n=0;n<this.hooks[e].length;n++)if(this.hooks[e][n]==t)return this.hooks[e].splice(n,1),!0;return!1},i.prototype.emit=function(){var e,t,n,r,i,s,o,u;e=arguments[0],"string"!=typeof e&&this.throwErr("TypeError","emit","first argument must be string"),this.hooks[e]||this.throwErr("TypeError","emit","unknown event: "+e),i=this.hooks[e].length;if(!i)return!0;s=arguments.length;switch(i){case 1:t=this.hooks[e][0];if(s===1)u=t.call(this);else if(s===2)u=t.call(this,arguments[1]);else if(s===3)u=t.call(this,arguments[1],arguments[2]);else{o=new Array(s-1);for(r=0;r<s;r++)o[r]=arguments[r+1];u=t.apply(this,o)}break;case 2:t=this.hooks[e][0],n=this.hooks[e][1];if(s===1)u=t.call(this)!==!1,u=u&&n.call(this)!==!1;else if(s===2)u=t.call(this,arguments[1])!==!1,u=u&&n.call(this,arguments[1])!==!1;else if(s===3)u=t.call(this,arguments[1],arguments[2])!==!1,u=u&&n.call(this,arguments[1],arguments[2])!==!1;else{o=new Array(s-1);for(r=0;r<s;r++)o[r]=arguments[r+1];u=t.apply(this,o)!==!1,u=u&&n.apply(this,o)!==!1}break;default:if(s===1)for(r=0;r<i;r++){u=this.hooks[e][r].call(this)!==!1;if(u===!1)break}else if(s===2){u=!0;for(r=0;r<i;r++){u=this.hooks[e][r].call(this,arguments[1])!==!1;if(u===!1)break}}else if(s===3){u=!0;for(r=0;r<i;r++){u=this.hooks[e][r].call(this,arguments[1],arguments[2])!==!1;if(u===!1)break}}else{o=new Array(s-1);for(r=0;r<s;r++)o[r]=arguments[r+1];u=!0;for(r=0;r<i;r++){u=this.hooks[e][r].apply(this,o)!==!1;if(u===!1)break}}}return u},i.prototype._analyzeQuery=function(e,n,r){var i,o,u;"undefined"==typeof e&&s.call(this,"undefined dimension",e,n,r);if("undefined"!=typeof n){n==="="?n="==":n==="!=="&&(n="!="),n in this.filters||s.call(this,"unknown operator "+n,e,n,r);if(t.inArray(n,["><","<>","in","!in"])){r instanceof Array||(u="range-queries need an array as third parameter",s.call(this,u,e,n,r));if(n==="<>"||n==="><")t.isArray(e)||(r[0]=t.setNestedValue(e,r[0]),r[1]=t.setNestedValue(e,r[1]))}else if(t.inArray(n,["!=",">","==",">=","<","<="])){"undefined"==typeof r&&(u="value cannot be undefined in comparison queries",s.call(this,u,e,n,r));if(t.isArray(e)){o=e.length;for(i=0;i<o;i++)t.setNestedValue(e[i],r)}else r=t.setNestedValue(e,r)}}else"undefined"!=typeof r?(u="undefined filter and defined value",s.call(this,u,e,n,r)):(n="E",r="");return{d:e,op:n,value:r}},i.prototype.distinct=function(){return this.breed(t.distinct(this.db))},i.prototype.select=function(e,t,n){return this.query.reset(),arguments.length?this.and(e,t,n):this},i.prototype.and=function(e,t,n){var r,i;return r=this._analyzeQuery(e,t,n),i=this.filters[r.op](r.d,r.value,this.getComparator(r.d)),this.query.addCondition("AND",i),this},i.prototype.or=function(e,t,n){var r,i;return r=this._analyzeQuery(e,t,n),i=this.filters[r.op](r.d,r.value,this.getComparator(r.d)),this.query.addCondition("OR",i),this},i.prototype.selexec=function(e,t,n){return this.select(e,t,n).execute()},i.prototype.execute=function(){return this.filter(this.query.get.call(this.query))},i.prototype.exists=function(e){var n,r,i;"object"!=typeof e&&"function"!=typeof e&&this.throwErr("TypeError","exists","o must be object or function"),i=this.fetch(),r=i.length;for(n=0;n<i.length;n++)if(t.equals(i[n],e))return!0;return!1},i.prototype.limit=function(e){var t;return"number"!=typeof e&&this.throwErr("TypeError","exists","limit must be number"),t=this.fetch(),e!==0&&(t=e>0?t.slice(0,e):t.slice(e)),this.breed(t)},i.prototype.reverse=function(){return this.db.reverse(),this},i.prototype.sort=function(e){var t,n;return e?"function"==typeof e?t=e:e instanceof Array?(n=this,t=function(t,r){var i,s;for(i=0;i<e.length;i++){s=n.getComparator(e[i]).call(n,t,r);if(s!==0)return s}return s}):t=this.getComparator(e):t=this.globalCompare,this.db.sort(t),this},i.prototype.shuffle=function(e){var n;return n=t.shuffle(this.db),e&&(this.db=n,this.rebuildIndexes()),this.breed(n)},i.prototype.filter=function(e){return this.breed(this.fetch().filter(e))},i.prototype.each=i.prototype.forEach=function(){var e,t,n,r,i,s;e=arguments[0],"function"!=typeof e&&this.throwErr("TypeError","each","first argument must be function"),n=this.fetch(),r=n.length,s=arguments.length;switch(s){case 1:for(t=0;t<r;t++)e.call(this,n[t]);break;case 2:for(t=0;t<r;t++)e.call(this,n[t],arguments[1]);break;case 3:for(t=0;t<r;t++)e.call(this,n[t],arguments[1],arguments[2]);break;default:i=new Array(s+1),i[0]=null;for(t=1;t<s;t++)i[t]=arguments[t];for(t=0;t<r;t++)i[0]=n[t],e.apply(this,i)}},i.prototype.map=function(){var e,t,n,r,i,s,o,u;e=arguments[0],"function"!=typeof e&&this.throwErr("TypeError","map","first argument must be function"),n=this.fetch(),r=n.length,u=arguments.length,i=[];switch(u){case 1:for(t=0;t<r;t++)s=e.call(this,n[t]),"undefined"!=typeof s&&i.push(s);break;case 2:for(t=0;t<r;t++)s=e.call(this,n[t],arguments[1]),"undefined"!=typeof s&&i.push(s);break;case 3:for(t=0;t<r;t++)s=e.call(this,n[t],arguments[1],arguments[2]),"undefined"!=typeof s&&i.push(s);break;default:o=new Array(u+1),o[0]=null;for(t=1;t<u;t++)o[t]=arguments[t];for(t=0;t<r;t++)o[0]=n[t],s=e.apply(this,o),"undefined"!=typeof s&&i.push(s)}return i},i.prototype.update=function(e){var n,r,i,s;"object"!=typeof e&&this.throwErr("TypeError","update","update must be object"),i=this.fetch(),r=i.length;if(r){for(n=0;n<r;n++)s=this.emit("update",i[n],e),s===!0&&(t.mixin(i[n],e),this._indexIt(i[n]),this._hashIt(i[n]),this._viewIt(i[n]));this._autoUpdate({indexes:!1})}return this},i.prototype.removeAllEntries=function(){return console.log("***NDDB.removeAllEntries is deprecated. Use NDDB.clear instead***"),this.db.length?(this.emit("remove",this.db),this.nddbid.resolve={},this.db=[],this._autoUpdate(),this):this},i.prototype.clear=function(){var e;this.db=[],this.nddbid.resolve={},this.tags={},this.query.reset(),this.nddb_pointer=0,this.lastSelection=[],this.hashtray.clear();for(e in this.__H)this[e]&&(this[e]=null);for(e in this.__C)this[e]&&(this[e]=null);for(e in this.__I)this[e]&&(this[e]=null)},i.prototype.join=function(e,n,r,i){return this._join(e,n,t.equals,r,i)},i.prototype.concat=function(e,t,n,r){return this._join(e,t,function(){return!0},n,r)},i.prototype._join=function(e,n,r,i,s){var o,u,a,f,l,c,h,p;if(!e||!n)return this.breed([]);r=r||t.equals,i="undefined"!=typeof i?i:"joined",s&&(s=s instanceof Array?s:[s]),o=[],u=[];for(l=0;l<this.db.length;l++){a=t.getNestedValue(e,this.db[l]);if("undefined"!=typeof a)for(c=l+1;c<this.db.length;c++)f=t.getNestedValue(n,this.db[c]),"undefined"!=typeof f&&r(a,f)&&(h=t.clone(this.db[l]),p=s?t.subobj(this.db[c],s):this.db[c],h[i]=p,o.push(h))}return this.breed(o)},i.prototype.split=function(e,n,r){var i,s,o,u;"string"!=typeof e&&this.throwErr("TypeError","split","key must be string"),o=this.fetch(),u=o.length,i=[];for(s=0;s<u;s++)i=i.concat(t.split(o[s],e,n,r));return this.breed(i)},i.prototype.fetch=function(e){var t;return this.db.length&&this.query.query.length?(e&&"boolean"!=typeof e&&this.throwErr("TypeError","fetch","doNotReset must be undefined or boolean"),t=this.db.filter(this.query.get.call(this.query)),e||this.query.reset()):t=this.db,this.lastSelection=t,t},i.prototype.fetchSubObj=function(e){var n,r,i,s;if(!e)return[];i=this.fetch(),s=[];for(n=0;n<i.length;n++)r=t.subobj(i[n],e),t.isEmpty(r)||s.push(r);return s},i.prototype.fetchValues=function(e){var n,r,i,s,o;n=this.fetch(),o=typeof e,s={};if(o==="undefined")for(i=0;i<n.length;i++)t.augment(s,n[i],t.keys(n[i]));else if(o==="string"){s[e]=[];for(i=0;i<n.length;i++)r=t.getNestedValue(e,n[i]),"undefined"!=typeof r&&s[e].push(r)}else if(t.isArray(e)){s=t.melt(e,t.rep([],e.length));for(i=0;i<n.length;i++)r=t.subobj(n[i],e),t.isEmpty(r)||t.augment(s,r)}return s},i.prototype._fetchArray=function(e,t){var n,r,i,s,h;t?e?"string"==typeof e?r=l:r=c:r=u:e?"string"==typeof e?r=a:r=f:r=o,n=this.fetch(),i=[];for(h=0;h<n.length;h++)s=r.call(n[h],n[h],e),"undefined"!=typeof s&&i.push(s);return i},i.prototype.fetchArray=function(e){return this._fetchArray(e)},i.prototype.fetchKeyArray=function(e){return this._fetchArray(e,!0)},i.prototype.groupBy=function(e){var n,r,i,s,o,u;u=this.fetch();if(!e)return u;n=[],r=[];for(i=0;i<u.length;i++){s=t.getNestedValue(e,u[i]);if("undefined"==typeof s)continue;t.inArray(s,n)||(n.push(s),o=this.filter(function(n){if(t.equals(t.getNestedValue(e,n),s))return n}),o.nddb_pointer=0,r.push(o))}return r},i.prototype.count=function(e){var n,r,i,s;s=this.fetch(),i=s.length;if("undefined"==typeof e)return i;"string"!=typeof e&&this.throwErr("TypeError","count","key must be string or undefined"),r=0;for(n=0;n<i;n++)t.hasOwnNestedProperty(e,s[n])&&r++;return r},i.prototype.sum=function(e){var n,r,i,s,o;"string"!=typeof e&&this.throwErr("TypeError","sum","key must be string"),o=this.fetch(),i=o.length,n=NaN;for(r=0;r<i;r++)s=t.getNestedValue(e,o[r]),isNaN(s)||(isNaN(n)&&(n=0),n+=s);return n},i.prototype.mean=function(e){var n,r,i,s,o,u;"string"!=typeof e&&this.throwErr("TypeError","mean","key must be string"),s=this.fetch(),u=s.length,n=0,r=0;for(o=0;o<u;o++)i=t.getNestedValue(e,s[o]),isNaN(i)||(n+=i,r++);return r===0?NaN:n/r},i.prototype.stddev=function(e){var n,r,i,s,o,u,a;"string"!=typeof e&&this.throwErr("TypeError","stddev","key must be string"),i=this.fetch(),o=i.length;if(!o||o===1)return NaN;s=-1,u=0,a=0,n=0;for(;++s<o;)r=t.getNestedValue(e,i[s]),isNaN(r)||(n++,u+=r,a+=Math.pow(r,2));return r=a-Math.pow(u,2)/n,Math.sqrt(r/(n-1))},i.prototype.min=function(e){var n,r,i,s,o;"string"!=typeof e&&this.throwErr("TypeError","min","key must be string"),i=this.fetch(),o=i.length,n=NaN;for(s=0;s<o;s++)r=t.getNestedValue(e,i[s]),!isNaN(r)&&(r<n||isNaN(n))&&(n=r);return n},i.prototype.max=function(e){var n,r,i,s,o;"string"!=typeof e&&this.throwErr("TypeError","max","key must be string"),o=this.fetch(),i=o.length,n=NaN;for(r=0;r<i;r++)s=t.getNestedValue(e,o[r]),!isNaN(s)&&(s>n||isNaN(n))&&(n=s);return n},i.prototype.skim=function(e){return"string"!=typeof e&&!t.isArray(e)&&this.throwErr("TypeError","skim","skim must be string or array"),this.breed(this.map(function(n){var r=t.skim(n,e);if(!t.isEmpty(r))return r}))},i.prototype.keep=function(e){return"string"!=typeof e&&!t.isArray(e)&&this.throwErr("TypeError","keep","keep must be string or array"),this.breed(this.map(function(n){var r=t.subobj(n,e);if(!t.isEmpty(r))return r}))},i.prototype.diff=function(e){return t.isArray(e)||(("object"!=typeof e||!t.isArray(e.db))&&this.throwErr("TypeError","diff","nddb must be array or NDDB"),e=e.db),e.length?this.breed(t.arrayDiff(this.fetch(),e)):this.breed([])},i.prototype.intersect=function(e){return t.isArray(e)||(("object"!=typeof e||!t.isArray(e.db))&&this.throwErr("TypeError","intersect","nddb must be array or NDDB"),e=e.db),e.length?this.breed(t.arrayIntersect(this.fetch(),e)):this.breed([])},i.prototype.get=function(e){return"number"!=typeof e&&this.throwErr("TypeError","get","pos must be number"),this.db[e]},i.prototype.current=function(){return this.db[this.nddb_pointer]},i.prototype.next=function(){var e;return this.nddb_pointer++,e=i.prototype.current.call(this),e||this.nddb_pointer--,e},i.prototype.previous=function(){var e;return this.nddb_pointer--,e=i.prototype.current.call(this),e||this.nddb_pointer++,e},i.prototype.first=function(e){var t=this.fetch();return t.length?(e||(this.nddb_pointer=0),t[0]):undefined},i.prototype.last=function(e){var t=this.fetch();return t.length?(e||(this.nddb_pointer=t.length-1),t[t.length-1]):undefined},i.prototype.tag=function(e,t){var n,r;return"string"!=typeof e&&"number"!=typeof e&&this.throwErr("TypeError","tag","tag must be string or number"),n=null,r=typeof t,r==="undefined"?n=this.db[this.nddb_pointer]:r==="number"?((t>this.length||t<0)&&this.throwErr("Error","tag","invalid index provided: "+t),n=this.db[t]):n=t,this.tags[e]=n,n},i.prototype.resolveTag=function(e){return"string"!=typeof e&&this.throwErr("TypeError","resolveTag","tag must be string"),this.tags[e]},i.prototype.load=function(e,t,n){arguments.length===2&&"function"==typeof t&&(n=t,t=undefined),v(this,"load",e,n,t)},i.prototype.save=function(e,t,n){arguments.length===2&&"function"==typeof t&&(n=t,t=undefined),v(this,"save",e,n,t)},i.prototype.loadSync=function(e,t,n){arguments.length===2&&"function"==typeof t&&(n=t,t=undefined),v(this,"loadSync",e,n,t)},i.prototype.saveSync=function(e,t,n){arguments.length===2&&"function"==typeof t&&(n=t,t=undefined),v(this,"saveSync",e,n,t)},i.prototype.addFormat=function(e,n){var r,i,s;g(this,e,n),t.isArray(e)||(e=[e]),i=-1,s=e.length;for(;++i<s;)r=e[i],("string"!=typeof r||r.trim()==="")&&this.throwErr("TypeError","addFormat","format must be a non-empty string"),this.__formats[r]=n},i.prototype.getFormat=function(e,t){var n;return"string"!=typeof e&&this.throwErr("TypeError","getFormat","format must be string"),t&&"string"!=typeof t&&this.throwErr("TypeError","getFormat","method must be string or undefined"),n=this.__formats[e],n&&t&&(n=n[t]),n||null},i.prototype.setDefaultFormat=function(e){e!==null&&("string"!=typeof e||e.trim()==="")&&this.throwErr("TypeError","setDefaultFormat","format must be a non-empty string or null"),e&&!this.__formats[e]&&this.throwErr("Error","setDefaultFormat","unknown format: "+e),this.__defaultFormat=e},i.prototype.getDefaultFormat=function(){return this.__defaultFormat},i.prototype.addDefaultFormats=null,y.prototype.addCondition=function(e,t){this.query[this.pointer].push({type:e,cb:t})},y.prototype.addBreak=function(){this.pointer++,this.query[this.pointer]=[]},y.prototype.reset=function(){this.query=[],this.pointer=0,this.query[this.pointer]=[]},y.prototype.get=function(){var e,t,n,r,i,s,o,u=this.query,a=this.pointer;if(a===0){e=u[a],t=e.length;if(t===1)return b(e[0]);if(t===2){n=b(e[0]),r=b(e[1]),s=e[1].type;switch(s){case"OR":return function(e){if("undefined"!=typeof n(e))return e;if("undefined"!=typeof r(e))return e};case"AND":return function(e){if("undefined"!=typeof n(e)&&"undefined"!=typeof r(e))return e};case"NOT":return function(e){if("undefined"!=typeof n(e)&&"undefined"==typeof r(e))return e}}}else{if(t!==3)return function(n){var r,i,s,o,u="OR",a=!0;for(r=t-1;r>-1;r--){i=b(e[r]),s=e[r].type,o="undefined"!=typeof i(n);if(s==="OR"){if(o)return n}else if(s==="AND"){if(!o)return;if(u==="OR"&&!a)return}u=s,a=s==="AND"?o:o||a}return n};n=b(e[0]),r=b(e[1]),i=b(e[2]),s=e[1].type,o=e[2].type,s=s+"_"+o;switch(s){case"OR_OR":return function(e){if("undefined"!=typeof n(e))return e;if("undefined"!=typeof r(e))return e;if("undefined"!=typeof i(e))return e};case"OR_AND":return function(e){if("undefined"==typeof i(e))return;if("undefined"!=typeof r(e))return e;if("undefined"!=typeof n(e))return e};case"AND_OR":return function(e){if("undefined"!=typeof i(e))return e;if("undefined"==typeof r(e))return;if("undefined"!=typeof n(e))return e};case"AND_AND":return function(e){if("undefined"==typeof i(e))return;if("undefined"==typeof r(e))return;if("undefined"!=typeof n(e))return e}}}}},w.prototype.set=function(e,t,n){this.resolve[e+"_"+t]=n},w.prototype.get=function(e,t){return this.resolve[e+"_"+t]},w.prototype.remove=function(e,t){delete this.resolve[e+"_"+t]},w.prototype.clear=function(){this.resolve={}},E.prototype._add=function(e,t){this.resolve[e]=t,"undefined"==typeof this.resolveKeys[e]&&(this.resolveKeys[e]=this.keys.length,this.keys.push(""+e))},E.prototype._remove=function(e){delete this.resolve[e],this.keys.splice(this.resolveKeys[e],1),delete this.resolveKeys[e]},E.prototype.size=function(){return this.keys.length},E.prototype.get=function(e){return"undefined"==typeof this.resolve[e]?!1:this.nddb.db[this.resolve[e]]},E.prototype.remove=function(e){var t,n,r;return n=this.resolve[e],"undefined"==typeof n?!1:(t=this.nddb.db[n],"undefined"==typeof t?!1:(r=this.nddb.emit("remove",t),r===!1?!1:(this.nddb.db.splice(n,1),this._remove(e),this.nddb._autoUpdate(),t)))},E.prototype.pop=E.prototype.remove,E.prototype.update=function(e,n){var r,i,s,o;return i=this.resolve[e],"undefined"==typeof i?!1:(s=this.nddb,r=s.db[i],o=s.emit("update",r,n),o===!1?!1:(t.mixin(r,n),s.__update.indexes&&(s._indexIt(r,i,e),s._hashIt(r),s._viewIt(r)),s._autoUpdate({indexes:!1}),r))},E.prototype.getAllKeys=function(){return this.keys.slice(0)},E.prototype.getAllKeyElements=function(){var e,t,n,r;e={},n=-1,r=this.keys.length;for(;++n<r;)t=this.keys[n],e[t]=this.nddb.db[this.resolve[t]];return e}}("undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports:window,"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.parent.exports.JSUS||require("JSUS").JSUS:JSUS,"object"==typeof module&&"function"==typeof require?module.parent.exports.store||require("shelf.js/build/shelf-fs.js").store:this.store),NDDB.prototype.storageAvailable=function(){return"function"==typeof store},NDDB.prototype.addDefaultFormats=function(){this.__formats.store={loadSync:function(e,t,n,r){var i,s;i=store(t);if("undefined"==typeof i)return;"string"==typeof i&&(i=JSUS.parse(i)),JSUS.isArray(i)||e.throwErr("Error","load","expects to load an array");for(s=0;s<i.length;s++)i[s]=NDDB.retrocycle(i[s]);e.importDB(i),n&&n()},saveSync:function(e,t,n,r){store(t,e.stringify(!!r.compress)),n&&n()}},this.setDefaultFormat("store")}